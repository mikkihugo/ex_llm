# https://moonrepo.dev/schemas/project.json
$schema: '../../.moon/cache/schemas/project.json'

type: 'library'
language: 'rust'
project:
  name: '@singularity/package_intelligence'
  description: 'Rust library/binary for semantic indexing of npm, cargo, hex, and pypi packages'
  channel: '#internal'
  owner: 'singularity'
  maintainers: ['mikkihugo']

tasks:
  # Rust cargo tasks
  cargo:build:
    command: 'cargo build --release'
    inputs:
      - 'src/**/*.rs'
      - 'Cargo.toml'
      - 'build.rs'
    outputs:
      - 'target/release/'
    options:
      cache: true
      runInCI: true

  cargo:test:
    command: 'cargo test --release'
    deps:
      - 'cargo:build'
    inputs:
      - 'src/**/*.rs'
      - 'tests/**/*.rs'
      - 'Cargo.toml'
    options:
      cache: true
      runInCI: true

  cargo:check:
    command: 'cargo check'
    inputs:
      - 'src/**/*.rs'
      - 'Cargo.toml'
    options:
      cache: true
      runInCI: true

  cargo:clippy:
    command: 'cargo clippy --all-targets --all-features -- -D warnings'
    deps:
      - 'cargo:check'
    options:
      cache: true
      runInCI: true

  # Documentation
  docs:
    command: 'cargo doc --no-deps --document-private-items'
    inputs:
      - 'src/**/*.rs'
    outputs:
      - 'target/doc/'

# This package indexes external package registries
# Can be published to crates.io or internal registry
