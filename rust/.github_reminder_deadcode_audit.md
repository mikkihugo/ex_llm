# Dead Code Audit Schedule

## Next Audit Date: July 23, 2025

**Frequency:** Every 6 months
**Last Audit:** January 23, 2025
**Result:** 5 items removed, 35 items validated

---

## Audit Process

### Step 1: Scan for Annotations
```bash
cd rust
find . -name "*.rs" -type f | \
  grep -v target | \
  grep -v ".cargo-build" | \
  xargs grep -n "#\[allow(dead_code)\]" > /tmp/deadcode_scan.txt

# Count total annotations
wc -l /tmp/deadcode_scan.txt
```

### Step 2: Extract Detailed Context
```bash
# For each file, get annotation + 3 lines of context
for file in $(find . -name "*.rs" -type f | \
              grep -v target | \
              grep -v ".cargo-build" | \
              xargs grep -l "#\[allow(dead_code)\]" 2>/dev/null); do
    echo "FILE: $file"
    echo "---"
    grep -n -A 3 "#\[allow(dead_code)\]" "$file" | head -30
    echo ""
done > /tmp/deadcode_details.txt
```

### Step 3: Categorize Each Annotation

Use the checklist:

- [ ] **Struct fields used by derive macros?**
  - ✅ KEEP with comment: `// Used by Debug/Serde`

- [ ] **Documented as future feature?**
  - ✅ KEEP if comment explains why and when
  - ❌ REMOVE if no plan or outdated

- [ ] **Helper function?**
  - ✅ KEEP if ensures correctness
  - ⚠️ USE IT if reduces duplication
  - ❌ REMOVE if never called and no plans

- [ ] **For a disabled feature?**
  - ✅ KEEP if temporary (will re-enable)
  - ❌ REMOVE if permanently disabled

- [ ] **Public API?**
  - ✅ KEEP even if unused internally
  - Add comment: `// Public API - used by X crate`

### Step 4: Check for "Future Features" Implementation

Review annotations marked "Reserved for future" from previous audit:

```bash
# Find all "Reserved for" comments
grep -r "Reserved for" rust/ --include="*.rs" | grep "allow(dead_code)"
```

For each:
- Has the feature been implemented?
- If YES → Remove `#[allow(dead_code)]` annotation
- If NO → Keep annotation, verify plan is still valid

### Step 5: Verify Compilation

After any changes:

```bash
cargo clean
cargo check --workspace
cargo test --workspace
```

---

## Historical Results

### January 2025 Audit
- **Total annotations found:** 40
- **Valid (kept):** 35 (87.5%)
- **Invalid (removed):** 5 (12.5%)
- **Files modified:** 2
- **Compilation errors:** 0

**Removed:**
- `dependencies.rs`: 4 RCA placeholder functions + parsers field
- `node.rs`: 1 unused `get_parent()` method

**Categories (35 kept):**
- Struct fields (Debug/Serde): 18
- Future features: 7
- Cache placeholders: 4
- Helper functions: 4
- Other valid: 2

---

## Automation Scripts

### Quick Scan Script

Save as `rust/scripts/scan_dead_code.sh`:

```bash
#!/bin/bash
echo "=== Dead Code Scan ===" 
echo ""
echo "Date: $(date)"
echo ""

total=0
for file in $(find ./rust -name "*.rs" -type f | \
              grep -v target | \
              grep -v ".cargo-build" | \
              xargs grep -l "#\[allow(dead_code)\]" 2>/dev/null); do
    count=$(grep -c "#\[allow(dead_code)\]" "$file")
    total=$((total + count))
    printf "%-70s %3d\n" "$file" "$count"
done

echo ""
echo "Total #[allow(dead_code)] annotations: $total"
echo ""
echo "Previous audit (Jan 2025): 35 annotations"
echo "Change: $((total - 35))"
```

### Detailed Analysis Script

Save as `rust/scripts/analyze_dead_code.sh`:

```bash
#!/bin/bash
echo "=== Detailed Dead Code Analysis ==="
echo ""

for file in $(find ./rust -name "*.rs" -type f | \
              grep -v target | \
              grep -v ".cargo-build" | \
              xargs grep -l "#\[allow(dead_code)\]" 2>/dev/null); do
    echo "FILE: $file"
    echo "---"
    
    # Get line numbers and context
    grep -n -A 3 "#\[allow(dead_code)\]" "$file" | head -30
    echo ""
done
```

### Make Scripts Executable

```bash
chmod +x rust/scripts/scan_dead_code.sh
chmod +x rust/scripts/analyze_dead_code.sh
```

---

## Reporting Template

After audit, create report: `DEAD_CODE_AUDIT_YYYY_MM.md`

```markdown
# Dead Code Audit - [Month] [Year]

## Summary

**Date:** [Date]
**Total Annotations:** [Count]
**Valid (Kept):** [Count] ([Percentage]%)
**Invalid (Removed):** [Count] ([Percentage]%)

## Changes Made

### Removed
1. [File]: [Description]
2. ...

### Added Comments
1. [File]: [Description of documentation added]
2. ...

### Used Helpers
1. [File]: [Description of helper usage]
2. ...

## Compilation Verification

```bash
$ cargo check --workspace
[Output]
```

## Statistics Comparison

| Audit Date | Total | Valid | Invalid | % Invalid |
|------------|-------|-------|---------|-----------|
| Jan 2025   | 40    | 35    | 5       | 12.5%     |
| [Current]  | [X]   | [Y]   | [Z]     | [%]       |

## Recommendations

[Any patterns noticed, recurring issues, etc.]
```

---

## Quick Reference

**Good annotation:**
```rust
#[allow(dead_code)] // Reserved for caching optimization (Issue #123)
cache: HashMap<String, Value>,
```

**Bad annotation:**
```rust
#[allow(dead_code)]  // No explanation
helper() { ... }
```

---

## Contact / Questions

For questions about dead code policy, see:
- `DEAD_CODE_QUICK_REFERENCE.md` - Guidelines
- `DEAD_CODE_CLEANUP_COMPLETE.md` - Last cleanup report
- `RUST_MAINTENANCE_GUIDE.md` - Comprehensive guide
