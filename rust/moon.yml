$schema: '../.moon/cache/schemas/project.json'

language: 'rust'
type: 'library'

tasks:
  build:
    command: 'cargo build --release -p prompt-engine -p universal-parser'
    inputs:
      - 'src/**/*'
      - 'Cargo.toml'
      - 'Cargo.lock'
    outputs:
      - 'target/'

  test:
    command: 'cargo test -p prompt-engine -p universal-parser'
    deps:
      - 'build'
    inputs:
      - 'src/**/*'
      - 'tests/**/*'
      - 'Cargo.toml'
      - 'Cargo.lock'

  check:
    command: 'cargo check -p prompt-engine -p universal-parser'
    inputs:
      - 'src/**/*'
      - 'Cargo.toml'

  service:
    command: 'cargo build --release --bin singularity-rust-service'
    inputs:
      - 'src/**/*'
      - 'Cargo.toml'
    outputs:
      - 'target/release/singularity-rust-service'

  start:
    command: 'cargo run --release --bin singularity-rust-service'
    deps:
      - 'service'
    options:
      persistent: true
