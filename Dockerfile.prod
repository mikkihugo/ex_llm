# Singularity Production Dockerfile
# This is generated by Nix flake - do not edit manually
FROM nixos/nix:latest

# Enable flakes
RUN echo "experimental-features = nix-command flakes" >> /etc/nix/nix.conf

# Copy source code
WORKDIR /app
COPY . .

# Build the production environment
RUN nix build .#dockerImage

# Set environment
ENV MIX_ENV=prod
ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8

# Expose ports
EXPOSE 4000 3000 4222 5432

# Start all services
CMD ["nix", "develop", ".#prod", "--command", "just", "start-all"]