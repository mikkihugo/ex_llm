{
  "framework_id": "soc2_type_ii",
  "name": "SOC 2 Type II",
  "description": "Service Organization Control 2 Type II - Security, Availability, Processing Integrity, Confidentiality, Privacy",
  "version": "2.0",
  "applicable_to": ["all"],
  "last_updated": "2025-10-30",

  "compliance_controls": [
    {
      "control_id": "CC6.1",
      "control_name": "Logical Access Control",
      "category": "Security",
      "description": "The entity restricts logical access to assets based on the entity's objectives related to operational and financial performance.",

      "code_requirements": [
        {
          "requirement": "Multi-factor authentication required",
          "languages": ["all"],
          "bad_patterns": [
            "password_only_login",
            "single_factor_auth",
            "basic_auth_only",
            "no_mfa_enforcement"
          ],
          "good_patterns": [
            "mfa_enabled",
            "totp_or_webauthn",
            "passwordless_auth",
            "biometric_authentication"
          ],
          "severity": "high"
        },
        {
          "requirement": "Least privilege access",
          "languages": ["all"],
          "bad_patterns": [
            "all_users_admin",
            "missing_role_checks",
            "no_permission_validation",
            "elevated_default_permissions"
          ],
          "good_patterns": [
            "rbac_implementation",
            "permission_checks",
            "role_based_routes",
            "principle_of_least_privilege"
          ],
          "severity": "critical"
        },
        {
          "requirement": "Session timeout",
          "languages": ["all"],
          "bad_patterns": [
            "no_session_timeout",
            "permanent_sessions",
            "infinite_token_lifetime",
            "no_idle_detection"
          ],
          "good_patterns": [
            "30min_timeout",
            "idle_timeout",
            "activity_based_timeout",
            "secure_session_management"
          ],
          "severity": "high"
        }
      ],

      "detection_rules": {
        "code_patterns": [
          "Missing MFA/2FA in authentication",
          "Admin role accessible without proper checks",
          "No session timeout configured",
          "Hardcoded credentials in source code"
        ]
      }
    },
    {
      "control_id": "CC6.2",
      "control_name": "Prior to Issue",
      "category": "Security",
      "description": "Prior to issuing system credentials to a new internal or external user and granting logical access to the entity's information assets, the entity restricts logical access.",
      "code_requirements": [
        {
          "requirement": "Identity verification before access",
          "languages": ["all"],
          "bad_patterns": [
            "automatic_access_grant",
            "no_identity_verification",
            "bypass_onboarding_checks"
          ],
          "good_patterns": [
            "identity_verification_workflow",
            "background_check_integration",
            "approval_workflow"
          ],
          "severity": "high"
        }
      ]
    },
    {
      "control_id": "CC6.3",
      "control_name": "User Access Removal",
      "category": "Security",
      "description": "The entity removes logical access privileges when those privileges are no longer required or when users are terminated.",
      "code_requirements": [
        {
          "requirement": "Automated deprovisioning",
          "languages": ["all"],
          "bad_patterns": [
            "manual_access_removal",
            "no_offboarding_process",
            "orphaned_accounts"
          ],
          "good_patterns": [
            "automated_deprovisioning",
            "immediate_access_revocation",
            "audit_trail_of_removals"
          ],
          "severity": "critical"
        }
      ]
    },
    {
      "control_id": "CC7.1",
      "control_name": "Malicious Code Detection",
      "category": "Monitoring",
      "description": "To meet its objectives, the entity uses detection and monitoring procedures to identify anomalies indicative of malicious code.",
      "code_requirements": [
        {
          "requirement": "Anti-malware protection",
          "languages": ["all"],
          "bad_patterns": [
            "no_input_validation",
            "unsafe_deserialization",
            "no_file_upload_scanning"
          ],
          "good_patterns": [
            "input_sanitization",
            "file_type_validation",
            "malware_scanning_integration"
          ],
          "severity": "high"
        }
      ]
    },
    {
      "control_id": "CC7.2",
      "control_name": "System Monitoring",
      "category": "Monitoring",
      "description": "The entity monitors system components and the operation of those components for anomalies that are indicative of malicious acts, errors, or deviations.",

      "code_requirements": [
        {
          "requirement": "Comprehensive audit logging",
          "languages": ["all"],
          "bad_patterns": [
            "no_audit_logging",
            "incomplete_logs",
            "no_sensitive_action_logging",
            "logs_with_sensitive_data"
          ],
          "good_patterns": [
            "all_access_logged",
            "failed_auth_logged",
            "privilege_changes_logged",
            "structured_logging"
          ],
          "severity": "critical"
        },
        {
          "requirement": "Log retention policy",
          "languages": ["all"],
          "bad_patterns": [
            "logs_deleted_immediately",
            "no_retention_policy",
            "mutable_logs",
            "no_log_backup"
          ],
          "good_patterns": [
            "90_day_retention",
            "1_year_retention",
            "immutable_logs",
            "centralized_logging"
          ],
          "severity": "high"
        }
      ]
    },
    {
      "control_id": "CC7.3",
      "control_name": "Vulnerability Management",
      "category": "Monitoring",
      "description": "The entity evaluates vulnerabilities and implements security patches and other necessary updates on a timely basis.",
      "code_requirements": [
        {
          "requirement": "Dependency vulnerability scanning",
          "languages": ["all"],
          "bad_patterns": [
            "outdated_dependencies",
            "no_vulnerability_scanning",
            "ignored_security_advisories"
          ],
          "good_patterns": [
            "automated_dependency_updates",
            "vulnerability_scanning_ci",
            "security_patch_management"
          ],
          "severity": "high"
        }
      ]
    },
    {
      "control_id": "CC8.1",
      "control_name": "Change Management",
      "category": "Operations",
      "description": "The entity authorizes, designs, develops or acquires, configures, documents, tests, approves, and implements changes to infrastructure, data, software, and procedures.",
      "code_requirements": [
        {
          "requirement": "Controlled change process",
          "languages": ["all"],
          "bad_patterns": [
            "direct_production_changes",
            "no_code_review",
            "no_testing_before_deploy"
          ],
          "good_patterns": [
            "change_approval_workflow",
            "mandatory_code_review",
            "automated_testing_pipeline"
          ],
          "severity": "high"
        }
      ]
    },
    {
      "control_id": "CC9.1",
      "control_name": "Data Protection",
      "category": "Confidentiality",
      "description": "The entity identifies and maintains confidential information to meet the entity's objectives related to confidentiality.",
      "code_requirements": [
        {
          "requirement": "Data classification and encryption",
          "languages": ["all"],
          "bad_patterns": [
            "plaintext_sensitive_data",
            "no_encryption_at_rest",
            "no_encryption_in_transit"
          ],
          "good_patterns": [
            "aes_256_encryption",
            "tls_1_3_minimum",
            "encrypted_database_fields"
          ],
          "severity": "critical"
        }
      ]
    },
    {
      "control_id": "CC9.2",
      "control_name": "Data Transmission",
      "category": "Confidentiality",
      "description": "The entity protects confidential information during transmission.",
      "code_requirements": [
        {
          "requirement": "Secure transmission protocols",
          "languages": ["all"],
          "bad_patterns": [
            "http_not_https",
            "unencrypted_api_calls",
            "plaintext_credentials"
          ],
          "good_patterns": [
            "https_only",
            "mutual_tls",
            "encrypted_websockets"
          ],
          "severity": "critical"
        }
      ]
    },
    {
      "control_id": "A1.1",
      "control_name": "Availability Commitments",
      "category": "Availability",
      "description": "The entity identifies and maintains commitments to customers and other external users regarding the availability of the entity's services and products.",
      "code_requirements": [
        {
          "requirement": "High availability design",
          "languages": ["all"],
          "bad_patterns": [
            "single_point_of_failure",
            "no_redundancy",
            "no_failover_mechanism"
          ],
          "good_patterns": [
            "load_balancing",
            "redundant_systems",
            "automatic_failover"
          ],
          "severity": "medium"
        }
      ]
    },
    {
      "control_id": "A1.2",
      "control_name": "Availability Monitoring",
      "category": "Availability",
      "description": "The entity monitors the availability of the entity's services and collects, maintains, and evaluates relevant quantitative and qualitative information.",
      "code_requirements": [
        {
          "requirement": "Service health monitoring",
          "languages": ["all"],
          "bad_patterns": [
            "no_health_checks",
            "no_uptime_monitoring",
            "no_alerting_system"
          ],
          "good_patterns": [
            "health_check_endpoints",
            "continuous_monitoring",
            "automated_alerting"
          ],
          "severity": "high"
        }
      ]
    }
  ],

  "code_checks": [
    {
      "check_name": "MFA Implementation",
      "check_id": "soc2_mfa",
      "description": "Verify multi-factor authentication is implemented",
      "severity": "high",
      "framework_controls": ["CC6.1"],
      "detection_rules": {
        "languages": ["python", "javascript", "java", "go", "ruby", "elixir"],
        "patterns": [
          "Missing 'mfa' or 'totp' or '2fa' in authentication",
          "Only 'password' check, no second factor",
          "Auth bypass without MFA verification"
        ]
      }
    },
    {
      "check_name": "Audit Logging",
      "check_id": "soc2_audit_logging",
      "description": "Verify all sensitive operations are logged",
      "severity": "critical",
      "framework_controls": ["CC7.2"],
      "detection_rules": {
        "languages": ["all"],
        "patterns": [
          "No logging of user login/logout",
          "No logging of privilege escalation",
          "No logging of data access",
          "Sensitive data in logs"
        ]
      }
    },
    {
      "check_name": "Session Management",
      "check_id": "soc2_session",
      "description": "Verify proper session timeout and management",
      "severity": "high",
      "framework_controls": ["CC6.1"],
      "detection_rules": {
        "languages": ["all"],
        "patterns": [
          "No session timeout configuration",
          "Infinite token lifetime",
          "Session fixation vulnerability"
        ]
      }
    },
    {
      "check_name": "Encryption Standards",
      "check_id": "soc2_encryption",
      "description": "Verify encryption at rest and in transit",
      "severity": "critical",
      "framework_controls": ["CC9.1", "CC9.2"],
      "detection_rules": {
        "languages": ["all"],
        "patterns": [
          "HTTP instead of HTTPS",
          "Plaintext password storage",
          "Unencrypted database connections",
          "Weak encryption algorithms"
        ]
      }
    }
  ],

  "remediation_roadmap": {
    "phase_1": {
      "timeline": "30 days",
      "controls": ["CC6.1", "CC7.2", "CC9.2"],
      "tasks": [
        "Implement MFA for all users",
        "Add comprehensive audit logging",
        "Enable session timeouts",
        "Enforce HTTPS everywhere"
      ]
    },
    "phase_2": {
      "timeline": "60 days",
      "controls": ["CC6.2", "CC6.3", "CC9.1"],
      "tasks": [
        "Implement RBAC",
        "Secure credential storage",
        "Add monitoring/alerting",
        "Encrypt sensitive data at rest"
      ]
    },
    "phase_3": {
      "timeline": "90 days",
      "controls": ["CC7.1", "CC7.3", "CC8.1"],
      "tasks": [
        "Implement vulnerability scanning",
        "Establish change management process",
        "Deploy malware detection",
        "Create disaster recovery plan"
      ]
    }
  },

  "references": [
    "https://www.aicpa.org/soc2/",
    "SOC 2 Trust Service Criteria",
    "https://www.aicpa-cima.agilebloc.com/DAM/AICPA/Research/AuditAttest/DownloadableDocuments/Trust-Service-Criteria-May-2017.pdf",
    "AICPA TSC 2017 Version"
  ]
}