{
  "pattern_id": "god_module",
  "name": "God Object/Module Anti-Pattern",
  "description": "Detect modules that do too much and violate single responsibility principle",
  "severity": "high",
  "type": "architecture_smell",

  "indicators": [
    {
      "indicator": "High LOC",
      "threshold": "> 1000 lines of code",
      "description": "Module is too large to understand",
      "thresholds_by_language": {
        "Java": "> 1000 LOC",
        "Python": "> 800 LOC",
        "JavaScript": "> 600 LOC",
        "C++": "> 1500 LOC",
        "Go": "> 500 LOC"
      },
      "measurement": "Count non-comment, non-blank lines"
    },
    {
      "indicator": "Too Many Responsibilities",
      "description": "Module handles unrelated concerns",
      "examples": [
        "UserManager handling users, payments, and emails",
        "OrderProcessor handling orders, shipping, and reporting",
        "ApplicationController doing routing, validation, and business logic",
        "DataService performing CRUD, caching, and transformation"
      ],
      "detection": [
        "Method names with different domain vocabularies",
        "Multiple unrelated import groups",
        "Comments separating different sections"
      ]
    },
    {
      "indicator": "High Cyclomatic Complexity",
      "threshold": "> 15 average method complexity",
      "description": "Complex logic indicates mixed responsibilities",
      "detailed_thresholds": {
        "method_complexity": "> 10",
        "class_complexity": "> 50",
        "file_complexity": "> 100"
      },
      "calculation": "Number of independent paths through code"
    },
    {
      "indicator": "Too Many Dependencies",
      "threshold": "> 10 imports",
      "description": "Needs too many other modules to function",
      "categories": {
        "external_libraries": "> 5",
        "internal_modules": "> 10",
        "total_dependencies": "> 15"
      },
      "red_flags": [
        "Imports from multiple layers",
        "Circular dependencies",
        "Imports from unrelated domains"
      ]
    },
    {
      "indicator": "Too Many Public Methods",
      "threshold": "> 20 public methods",
      "description": "Large public interface, hard to use",
      "detailed_metrics": {
        "public_methods": "> 20",
        "total_methods": "> 50",
        "public_fields": "> 10"
      },
      "impact": "Violates Interface Segregation Principle"
    },
    {
      "indicator": "Too Many Instance Variables",
      "threshold": "> 15 instance variables",
      "description": "Too much state to manage",
      "consequences": [
        "Hard to maintain invariants",
        "Complex initialization",
        "Memory bloat"
      ]
    },
    {
      "indicator": "Low Cohesion",
      "description": "Methods don't operate on same data",
      "measurement": "LCOM (Lack of Cohesion of Methods)",
      "threshold": "LCOM > 0.8",
      "calculation": "Methods not sharing instance variables"
    },
    {
      "indicator": "High Change Frequency",
      "description": "File changes frequently for different reasons",
      "threshold": "> 50 commits per year",
      "analysis": "Git history shows changes for unrelated features"
    },
    {
      "indicator": "Multiple Concerns in Method Names",
      "description": "Method names indicate multiple actions",
      "examples": [
        "saveAndSendEmail()",
        "validateAndProcessAndStore()",
        "fetchDataAndTransformAndCache()"
      ],
      "pattern": "Methods with 'And' in name"
    },
    {
      "indicator": "Test Complexity",
      "description": "Tests require extensive setup",
      "symptoms": [
        "Test files longer than source files",
        "> 20 mocks/stubs per test",
        "Complex test fixtures",
        "Tests break for unrelated changes"
      ]
    }
  ],

  "refactoring": {
    "approach": "Single Responsibility Principle",
    "steps": [
      {
        "step": 1,
        "name": "Identify Responsibilities",
        "tasks": [
          "List all public methods",
          "Group methods by functionality",
          "Identify data used by each group",
          "Find natural boundaries"
        ],
        "techniques": [
          "Card sorting exercise",
          "Affinity mapping",
          "Domain modeling"
        ]
      },
      {
        "step": 2,
        "name": "Group Related Functionality",
        "tasks": [
          "Create cohesive groups",
          "Identify shared data",
          "Define interfaces between groups",
          "Document dependencies"
        ],
        "output": "Responsibility map"
      },
      {
        "step": 3,
        "name": "Create Separate Modules/Classes",
        "tasks": [
          "Extract first responsibility to new class",
          "Move related methods and data",
          "Update tests",
          "Refactor callers"
        ],
        "patterns": [
          "Extract Class",
          "Move Method",
          "Move Field"
        ]
      },
      {
        "step": 4,
        "name": "Define Clear Interfaces",
        "tasks": [
          "Create interfaces/protocols",
          "Hide implementation details",
          "Use dependency injection",
          "Document contracts"
        ],
        "principles": [
          "Program to interfaces",
          "Encapsulation",
          "Information hiding"
        ]
      },
      {
        "step": 5,
        "name": "Redistribute Responsibilities",
        "tasks": [
          "Move remaining methods to appropriate classes",
          "Eliminate god object",
          "Update documentation",
          "Refactor tests"
        ]
      }
    ],
    "patterns_to_apply": [
      {
        "pattern": "Facade Pattern",
        "when": "Need simple interface to complex subsystem",
        "benefit": "Hides complexity from clients"
      },
      {
        "pattern": "Strategy Pattern",
        "when": "Multiple algorithms in single class",
        "benefit": "Encapsulates algorithms separately"
      },
      {
        "pattern": "Chain of Responsibility",
        "when": "Complex conditional logic",
        "benefit": "Distributes decision making"
      },
      {
        "pattern": "Command Pattern",
        "when": "Many action methods",
        "benefit": "Encapsulates requests as objects"
      },
      {
        "pattern": "Observer Pattern",
        "when": "Managing multiple notifications",
        "benefit": "Decouples event producers from consumers"
      }
    ]
  },

  "examples": {
    "bad": {
      "name": "ApplicationManager",
      "responsibilities": [
        "User authentication",
        "Database connections",
        "Email sending",
        "Report generation",
        "Cache management",
        "Logging",
        "Configuration"
      ],
      "methods": 87,
      "lines": 3500,
      "dependencies": 25
    },
    "good": {
      "refactored_into": [
        {
          "name": "AuthenticationService",
          "responsibility": "User authentication",
          "methods": 8,
          "lines": 200
        },
        {
          "name": "DatabaseManager",
          "responsibility": "Database connections",
          "methods": 5,
          "lines": 150
        },
        {
          "name": "EmailService",
          "responsibility": "Email sending",
          "methods": 6,
          "lines": 180
        },
        {
          "name": "ReportGenerator",
          "responsibility": "Report generation",
          "methods": 12,
          "lines": 400
        },
        {
          "name": "CacheManager",
          "responsibility": "Cache management",
          "methods": 7,
          "lines": 220
        }
      ]
    }
  },

  "metrics": {
    "weighted_methods_per_class": {
      "name": "WMC",
      "description": "Sum of complexities of all methods",
      "good": "< 20",
      "concerning": "20-50",
      "critical": "> 50"
    },
    "depth_of_inheritance": {
      "name": "DIT",
      "description": "Maximum inheritance path from class to root",
      "good": "< 3",
      "concerning": "3-5",
      "critical": "> 5"
    },
    "number_of_children": {
      "name": "NOC",
      "description": "Number of immediate subclasses",
      "interpretation": "High NOC for god objects indicates widespread misuse"
    },
    "coupling_between_objects": {
      "name": "CBO",
      "description": "Number of classes coupled to",
      "good": "< 5",
      "concerning": "5-10",
      "critical": "> 10"
    },
    "lack_of_cohesion": {
      "name": "LCOM",
      "description": "Measure of cohesiveness",
      "formula": "(Methods not sharing fields) / Total methods",
      "good": "< 0.5",
      "concerning": "0.5-0.8",
      "critical": "> 0.8"
    }
  },

  "prevention": {
    "design_guidelines": [
      "Follow Single Responsibility Principle strictly",
      "Limit class size (< 300 lines)",
      "Limit method count (< 10 public methods)",
      "Regular refactoring sessions",
      "Code reviews focusing on responsibilities"
    ],
    "early_warning_signs": [
      "Class name contains 'Manager', 'Handler', or 'Processor'",
      "Difficulty naming the class clearly",
      "Multiple sections in class documentation",
      "Frequent merge conflicts in same file",
      "New developers confused by class purpose"
    ],
    "tools": [
      "Automated complexity analysis in CI/CD",
      "IDE warnings for large classes",
      "Regular architecture reviews",
      "Metrics dashboards"
    ]
  },

  "language_specific": {
    "java": {
      "indicators": [
        "Class with > 1000 LOC",
        "> 20 public methods",
        "> 15 instance variables"
      ],
      "tools": ["PMD", "Checkstyle", "SpotBugs"]
    },
    "python": {
      "indicators": [
        "Module with > 500 LOC",
        "Class with > 20 methods",
        "> 10 import statements"
      ],
      "tools": ["Pylint", "Radon", "Flake8"]
    },
    "javascript": {
      "indicators": [
        "File with > 400 LOC",
        "Object with > 15 methods",
        "> 10 require/import statements"
      ],
      "tools": ["ESLint", "JSHint", "Plato"]
    }
  }
}