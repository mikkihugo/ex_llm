{
  "id": "python-fastapi-endpoint",
  "name": "Python FastAPI Endpoint Generator",
  "description": "Generates FastAPI endpoints with Pydantic validation and async handlers",
  "steps": [
    {
      "name": "sparc-phase-1-research",
      "operation": {
        "type": "generate",
        "generate": "sparc-research"
      }
    },
    {
      "name": "sparc-phase-2-architecture",
      "operation": {
        "type": "generate",
        "generate": "sparc-architecture"
      }
    },
    {
      "name": "sparc-phase-3-security",
      "operation": {
        "type": "generate",
        "generate": "sparc-security"
      }
    },
    {
      "name": "sparc-phase-4-performance",
      "operation": {
        "type": "generate",
        "generate": "sparc-performance"
      }
    },
    {
      "name": "sparc-phase-5-implementation",
      "operation": {
        "type": "generate",
        "generate": "python-fastapi"
      }
    }
  ],
  "metadata": {
    "version": "2.0.0",
    "author": "SPARC Team",
    "created_at": "2025-10-04T00:00:00Z",
    "updated_at": "2025-10-04T00:00:00Z",
    "tags": [
      "python",
      "fastapi",
      "rest",
      "api",
      "async",
      "pydantic",
      "prompt-bits"
    ],
    "performance": {
      "avg_execution_time_ms": 100.0,
      "memory_usage_bytes": 2097152,
      "complexity": 5
    }
  },
  "detector_signatures": {
    "package_files": [
      "requirements.txt",
      "pyproject.toml",
      "setup.py"
    ],
    "dependencies": [
      "fastapi",
      "uvicorn",
      "pydantic"
    ],
    "file_patterns": [
      "main.py",
      "app.py",
      "api/**/*.py"
    ],
    "import_patterns": [
      "from fastapi import",
      "import fastapi",
      "from pydantic import",
      "FastAPI()",
      "@router"
    ],
    "config_files": [
      "pyproject.toml"
    ],
    "auto_load_prompt_bits": true,
    "prompt_bit_triggers": [
      {
        "when": "security_level == 'high'",
        "load_bits": [
          "fastapi-security-oauth2",
          "fastapi-rate-limiting"
        ]
      },
      {
        "when": "performance_profile == 'high-throughput'",
        "load_bits": [
          "fastapi-async-optimization",
          "fastapi-caching"
        ]
      }
    ],
    "min_confidence": 0.7
  },
  "ai_signature": {
    "name": "python_fastapi_endpoint",
    "inputs": {
      "entity_name": "Entity name in snake_case (e.g., user, product)",
      "api_version": "API version (v1, v2, etc.)",
      "auth_required": "Authentication required (true/false)",
      "validation_rules": "Pydantic validation constraints",
      "async_handlers": "Use async handlers (default: true)"
    },
    "outputs": {
      "python_code": "FastAPI endpoint code with type hints",
      "models": "Pydantic models with validation",
      "routes": "Router configuration",
      "tests": "Pytest async tests"
    },
    "instruction": "Generate production-ready FastAPI endpoint with: (1) Pydantic models with comprehensive validation, (2) Async request handlers with proper error handling, (3) OpenAPI documentation annotations, (4) Dependency injection for database/auth, (5) Structured logging, (6) Pytest async tests with fixtures. Follow Python best practices and PEP 8."
  },
  "template_content": "\"\"\"@business-domain {{business_domain}}\n@architecture-pattern rest-api\n@architecture-layer presentation\n@security-level {{security_level}}\n@performance-profile async-io\n@ai-signature python_fastapi_endpoint\n@llm-coder-optimized true\n\"\"\"\n\nfrom fastapi import APIRouter, HTTPException, Depends, status\nfrom pydantic import BaseModel, Field, validator\nfrom typing import Optional, List\nimport logging\nfrom datetime import datetime\n\nlogger = logging.getLogger(__name__)\nrouter = APIRouter(prefix=\"/{{entity_name}}\", tags=[\"{{entity_name}}\"])\n\n# @business-entity {{EntityName}}Response\n# @architecture-pattern response-dto\n# @security-pattern data-transfer-object\n# @ai-output python_code: response_model\nclass {{EntityName}}Response(BaseModel):\n    \"\"\"Response model for {{entity_name}} operations.\"\"\"\n    \n    id: str = Field(..., description=\"Unique identifier\")\n    name: str = Field(..., description=\"{{EntityName}} name\")\n    created_at: datetime = Field(..., description=\"Creation timestamp\")\n    updated_at: datetime = Field(..., description=\"Last update timestamp\")\n    \n    class Config:\n        json_schema_extra = {\n            \"example\": {\n                \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n                \"name\": \"Example {{EntityName}}\",\n                \"created_at\": \"2025-10-04T12:00:00Z\",\n                \"updated_at\": \"2025-10-04T12:00:00Z\"\n            }\n        }\n\n# @business-entity {{EntityName}}Request\n# @architecture-pattern request-dto\n# @security-pattern input-validation\n# @ai-output python_code: request_model\nclass {{EntityName}}Request(BaseModel):\n    \"\"\"Request model for creating/updating {{entity_name}}.\"\"\"\n    \n    name: str = Field(\n        ..., \n        min_length=1, \n        max_length=100,\n        description=\"{{EntityName}} name\"\n    )\n    \n    @validator('name')\n    def name_must_not_be_empty(cls, v: str) -> str:\n        \"\"\"@security-validation input-sanitization\"\"\"\n        if not v or not v.strip():\n            raise ValueError('Name cannot be empty or whitespace')\n        return v.strip()\n\n# @business-operation get_{{entity_name}}\n# @architecture-pattern controller\n# @security-operation data-retrieval\n# @performance-metric response-time\n# @test-scenario happy-path\n# @test-scenario not-found\n# @ai-output python_code: endpoint_handler\n@router.get(\n    \"/{id}\",\n    response_model={{EntityName}}Response,\n    status_code=status.HTTP_200_OK,\n    summary=\"Get {{entity_name}} by ID\",\n    response_description=\"{{EntityName}} details\"\n)\nasync def get_{{entity_name}}(\n    id: str,\n    # db: Database = Depends(get_database),  # Uncomment for DB integration\n) -> {{EntityName}}Response:\n    \"\"\"\n    Retrieve a {{entity_name}} by ID.\n    \n    - **id**: Unique identifier of the {{entity_name}}\n    \n    Returns the {{entity_name}} if found, otherwise raises 404.\n    \"\"\"\n    logger.info(f\"Retrieving {{entity_name}} with id: {id}\")\n    \n    # @security-validation input-sanitization\n    # @performance-critical-section\n    # TODO: Implement database query\n    # entity = await {{entity_name}}_service.get_by_id(db, id)\n    # if not entity:\n    #     raise HTTPException(\n    #         status_code=status.HTTP_404_NOT_FOUND,\n    #         detail=f\"{{EntityName}} with id {id} not found\"\n    #     )\n    \n    # Placeholder response\n    raise HTTPException(\n        status_code=status.HTTP_404_NOT_FOUND,\n        detail=f\"{{EntityName}} with id {id} not found\"\n    )\n\n# @business-operation create_{{entity_name}}\n# @architecture-pattern controller\n# @security-operation data-creation\n# @performance-metric response-time\n# @test-scenario happy-path\n# @test-scenario validation-error\n# @ai-output python_code: create_handler\n@router.post(\n    \"/\",\n    response_model={{EntityName}}Response,\n    status_code=status.HTTP_201_CREATED,\n    summary=\"Create new {{entity_name}}\",\n    response_description=\"Created {{entity_name}}\"\n)\nasync def create_{{entity_name}}(\n    request: {{EntityName}}Request,\n    # db: Database = Depends(get_database),  # Uncomment for DB integration\n) -> {{EntityName}}Response:\n    \"\"\"\n    Create a new {{entity_name}}.\n    \n    - **name**: Name of the {{entity_name}} (1-100 characters)\n    \n    Returns the created {{entity_name}} with generated ID and timestamps.\n    \"\"\"\n    logger.info(f\"Creating {{entity_name}} with name: {request.name}\")\n    \n    # @security-validation input-sanitization (handled by Pydantic)\n    # @performance-critical-section\n    # TODO: Implement database creation\n    # entity = await {{entity_name}}_service.create(db, request)\n    \n    # Placeholder response\n    raise HTTPException(\n        status_code=status.HTTP_501_NOT_IMPLEMENTED,\n        detail=\"Create operation not implemented\"\n    )\n\n# @business-operation update_{{entity_name}}\n# @architecture-pattern controller\n# @security-operation data-modification\n# @ai-output python_code: update_handler\n@router.put(\n    \"/{id}\",\n    response_model={{EntityName}}Response,\n    status_code=status.HTTP_200_OK,\n    summary=\"Update {{entity_name}}\",\n    response_description=\"Updated {{entity_name}}\"\n)\nasync def update_{{entity_name}}(\n    id: str,\n    request: {{EntityName}}Request,\n    # db: Database = Depends(get_database),  # Uncomment for DB integration\n) -> {{EntityName}}Response:\n    \"\"\"\n    Update an existing {{entity_name}}.\n    \n    - **id**: {{EntityName}} ID to update\n    - **name**: New name for the {{entity_name}}\n    \"\"\"\n    logger.info(f\"Updating {{entity_name}} {id} with name: {request.name}\")\n    \n    # TODO: Implement update logic\n    raise HTTPException(\n        status_code=status.HTTP_501_NOT_IMPLEMENTED,\n        detail=\"Update operation not implemented\"\n    )\n\n# @business-operation delete_{{entity_name}}\n# @architecture-pattern controller\n# @security-operation data-deletion\n# @ai-output python_code: delete_handler\n@router.delete(\n    \"/{id}\",\n    status_code=status.HTTP_204_NO_CONTENT,\n    summary=\"Delete {{entity_name}}\",\n    response_description=\"{{EntityName}} deleted successfully\"\n)\nasync def delete_{{entity_name}}(\n    id: str,\n    # db: Database = Depends(get_database),  # Uncomment for DB integration\n) -> None:\n    \"\"\"\n    Delete a {{entity_name}} by ID.\n    \n    - **id**: {{EntityName}} ID to delete\n    \"\"\"\n    logger.info(f\"Deleting {{entity_name}} with id: {id}\")\n    \n    # TODO: Implement delete logic\n    raise HTTPException(\n        status_code=status.HTTP_501_NOT_IMPLEMENTED,\n        detail=\"Delete operation not implemented\"\n    )\n\n# @test-scenario integration-tests\n# @ai-output tests: pytest_tests\n\"\"\"\nPytest tests (create in tests/test_{{entity_name}}.py):\n\nimport pytest\nfrom fastapi.testclient import TestClient\nfrom httpx import AsyncClient\n\n@pytest.mark.asyncio\nasync def test_get_{{entity_name}}_not_found(client: AsyncClient):\n    response = await client.get(\"/{{entity_name}}/nonexistent-id\")\n    assert response.status_code == 404\n\n@pytest.mark.asyncio\nasync def test_create_{{entity_name}}_success(client: AsyncClient):\n    payload = {\"name\": \"Test {{EntityName}}\"}\n    response = await client.post(\"/{{entity_name}}/\", json=payload)\n    assert response.status_code == 201\n    data = response.json()\n    assert data[\"name\"] == \"Test {{EntityName}}\"\n    assert \"id\" in data\n\n@pytest.mark.asyncio\nasync def test_create_{{entity_name}}_empty_name(client: AsyncClient):\n    payload = {\"name\": \"\"}\n    response = await client.post(\"/{{entity_name}}/\", json=payload)\n    assert response.status_code == 422  # Validation error\n\"\"\"\n",
  "parent_pattern": null
}