{
  "name": "Go Production Quality",
  "spec_version": "2.6.0",
  "capabilities": [
    "quality",
    "graph",
    "rag",
    "ai_navigation",
    "graph_db",
    "vector_db"
  ],
  "language": "go",
  "quality_level": "production",
  "description": "Production-grade quality standards for Go code with AI navigation metadata (JSON/YAML/Mermaid) for billion-line codebases, graph DB indexing (Neo4j), and vector DB optimization (pgvector)",
  "changelog": {
    "2.6.0": {
      "date": "2025-10-26",
      "changes": [
        "Added 6 gold standard production sections for true production readiness",
        "Security section: authentication, authorization, input validation, cryptography, OWASP, headers, API security",
        "Deployment section: containerization, CI/CD, infrastructure, health checks, scaling, DR",
        "API Design section: REST, GraphQL, versioning, OpenAPI documentation",
        "Data Persistence section: migrations, transactions, caching, event sourcing, retention",
        "Operational Excellence section: monitoring, SLA/SLO, incident management, cost optimization",
        "Compliance section: GDPR, CCPA, PCI DSS, HIPAA, SOX, audit logging",
        "Non-breaking: v2.5.0 modules remain valid, new sections are strongly recommended for production"
      ]
    },
    "2.5.0": {
      "date": "2025-10-24",
      "changes": [
        "Added 8 production readiness sections for production operations knowledge",
        "Sections: Performance Characteristics, Concurrency & Safety, Graceful Degradation, Version Compatibility, Configuration Guide, Observable Metrics, Troubleshooting, Architecture Decisions (ADR)",
        "Added 5 new interactive questions: error_tracking_integration, deployment_target, performance_critical, multi_platform, backward_compatibility",
        "Added 10 new scoring weights for production readiness assessment",
        "Non-breaking: v2.4.0 modules remain valid, v2.5.0 sections are optional but recommended for production",
        "Tier-based implementation: Tier 1 (Performance, Metrics, Troubleshooting, Safety), Tier 2 (Config, Degradation, Compatibility), Tier 3 (ADR, Decisions)"
      ]
    },
    "2.2.0": {
      "date": "2025-01-14",
      "changes": [
        "Added human-first documentation structure (human content top, AI metadata below separator)",
        "Added module_identity JSON for vector DB disambiguation",
        "Added architecture_diagram (Mermaid) for visual understanding",
        "Added call_graph (YAML) for graph DB indexing",
        "Added anti_patterns for duplicate prevention",
        "Added search_keywords for vector search optimization",
        "Enhanced prompts with documentation structure guidance",
        "Added scoring weights for AI-optimized metadata and documentation structure"
      ]
    },
    "2.0": {
      "date": "2025-01-08",
      "changes": [
        "Initial production template following Go official style guide"
      ]
    }
  },
  "requirements": {
    "documentation": {
      "package_docs": {
        "required": true,
        "format": "// Package comment",
        "min_length": 100,
        "must_include": [
          "overview",
          "examples",
          "usage_patterns",
          "human_content_first",
          "module_identity_json",
          "architecture_diagram",
          "call_graph_metadata",
          "anti_patterns"
        ],
        "ai_navigation": {
          "module_identity": {
            "format": "json",
            "required_fields": [
              "package",
              "purpose",
              "layer",
              "go_patterns",
              "related_packages",
              "alternatives",
              "disambiguation"
            ],
            "description": "JSON block for vector DB disambiguation and graph DB indexing (Go-specific)"
          },
          "architecture_diagram": {
            "format": "mermaid",
            "types": [
              "graph",
              "sequence",
              "flowchart"
            ],
            "description": "Visual architecture for AI understanding of call flow and data flow"
          },
          "call_graph": {
            "format": "yaml",
            "required_fields": [
              "calls_out",
              "called_by",
              "depends_on"
            ],
            "description": "Machine-readable call graph for graph DB indexing (Neo4j, etc.)"
          },
          "anti_patterns": {
            "format": "markdown",
            "sections": [
              "duplicate_modules",
              "usage_mistakes"
            ],
            "description": "Explicit duplicate prevention and usage warnings"
          },
          "search_keywords": {
            "format": "comma_separated",
            "min_count": 5,
            "description": "Keywords for vector search optimization (10+ recommended)"
          }
        }
      },
      "function_docs": {
        "required_for": [
          "all_exported_functions"
        ],
        "format": "// Function name description",
        "must_include": [
          "description",
          "examples"
        ]
      }
    },
    "error_handling": {
      "style": "explicit_error_returns",
      "pattern": "(result, error)",
      "no_panic": true,
      "check_all_errors": true
    },
    "testing": {
      "required": true,
      "framework": "testing package",
      "coverage_target": 80,
      "test_types": [
        "unit_tests",
        "table_driven_tests",
        "benchmarks"
      ]
    },
    "code_style": {
      "naming": "MixedCaps for exported, camelCase for unexported",
      "max_function_length": 50,
      "gofmt": "required",
      "golint": "required"
    },
    "security": {
      "authentication": {
        "jwt_handling": "Use golang-jwt/jwt for JWT validation, proper signing key rotation",
        "oauth2_flows": "Use golang.org/x/oauth2 for OAuth2 flows",
        "api_keys": "Store API keys in environment variables or secrets manager",
        "session_management": "Use gorilla/sessions with secure cookie settings"
      },
      "authorization": {
        "rbac": "Implement RBAC with casbin or custom middleware",
        "permissions": "Validate permissions at handler level",
        "audit_logging": "Log security events to structured logs"
      },
      "input_validation": {
        "sanitization": "Validate and sanitize all inputs (go-playground/validator)",
        "rate_limiting": "Use golang.org/x/time/rate or tollbooth middleware",
        "file_uploads": "Validate MIME types, size limits, scan files"
      },
      "cryptography": {
        "password_hashing": "Use bcrypt or argon2 (golang.org/x/crypto/bcrypt)",
        "encryption": "Use crypto/aes for encryption (GCM mode)",
        "secrets": "Use AWS Secrets Manager, HashiCorp Vault"
      },
      "owasp_compliance": {
        "injection": "Use parameterized queries (database/sql with placeholders)",
        "broken_auth": "Implement MFA, secure session handling",
        "sensitive_data": "Encrypt data at rest and in transit (TLS 1.3)",
        "xxe": "Disable XML external entities in encoding/xml",
        "broken_access": "Enforce authorization checks in middleware",
        "security_misconfig": "Secure defaults, remove debug handlers",
        "xss": "Escape HTML output (html/template auto-escapes)",
        "deserialization": "Validate JSON schemas before unmarshaling",
        "vulnerable_deps": "Run go mod verify, govulncheck regularly",
        "logging": "Don't log sensitive data, sanitize logs"
      },
      "security_headers": {
        "csp": "Content-Security-Policy: default-src 'self'",
        "hsts": "Strict-Transport-Security: max-age=31536000",
        "x_frame_options": "X-Frame-Options: DENY",
        "x_content_type": "X-Content-Type-Options: nosniff",
        "referrer_policy": "Referrer-Policy: no-referrer"
      },
      "api_security": {
        "rate_limiting": "Rate limit per-IP and per-user (tollbooth, ulule/limiter)",
        "cors": "Configure CORS with rs/cors package",
        "webhooks": "Validate webhook signatures (crypto/hmac)",
        "idempotency": "Use idempotency keys for critical operations"
      }
    },
    "deployment": {
      "containerization": {
        "docker": {
          "multi_stage": "Use multi-stage builds with scratch or distroless base",
          "non_root": "Run as non-root user (USER 1000)",
          "security_scanning": "Scan with Trivy, Snyk, govulncheck"
        },
        "kubernetes": {
          "resource_limits": "Set CPU/memory requests and limits",
          "network_policies": "Implement pod-to-pod network policies",
          "secrets": "Use Kubernetes Secrets or external secrets operator"
        }
      },
      "ci_cd": {
        "pipeline_stages": "Build -> Test -> Lint -> Security Scan -> Deploy",
        "testing": "Unit, integration, benchmark tests in CI",
        "quality_gates": "Coverage 80%+, golangci-lint pass, security scan clear",
        "deployment_strategies": "Blue-green, canary deployments"
      },
      "infrastructure": {
        "health_checks": "Liveness (/healthz) and readiness (/readyz) endpoints",
        "scaling": "Horizontal pod autoscaling based on CPU/memory",
        "observability": "Prometheus metrics, structured logging, OpenTelemetry traces",
        "disaster_recovery": "Automated backups, multi-AZ deployment"
      }
    },
    "api_design": {
      "rest": {
        "url_structure": "RESTful URLs with versioning (/api/v1/users/:id)",
        "pagination": "Cursor-based or offset pagination",
        "filtering": "Query params for filtering",
        "sorting": "Sort query param support"
      },
      "graphql": {
        "schema": "Use gqlgen for type-safe GraphQL",
        "rate_limiting": "Query complexity analysis",
        "subscriptions": "WebSocket subscriptions with auth"
      },
      "versioning": {
        "deprecation": "Deprecation headers with sunset dates",
        "backward_compatibility": "Maintain compatibility for 6+ months"
      },
      "documentation": {
        "openapi": "OpenAPI 3.0 spec with swaggo/swag",
        "examples": "Include request/response examples",
        "error_codes": "Document all error codes"
      }
    },
    "data_persistence": {
      "database": {
        "migrations": "Use golang-migrate or goose for migrations",
        "transactions": "Use sql.Tx for multi-step operations",
        "optimization": "Index foreign keys, analyze query plans"
      },
      "caching": {
        "strategies": "Cache-aside with go-redis",
        "invalidation": "TTL-based and event-driven invalidation",
        "distributed_cache": "Redis cluster or Memcached"
      },
      "event_sourcing": {
        "when_applicable": "Audit trails, CQRS patterns",
        "event_store": "EventStore, Kafka with sarama",
        "projections": "Build read models from events"
      },
      "data_retention": {
        "policies": "Define retention per data type",
        "archival": "Archive to S3 with lifecycle policies",
        "gdpr_compliance": "Right to erasure, data export"
      }
    },
    "operational_excellence": {
      "monitoring": {
        "golden_signals": "Latency, traffic, errors, saturation",
        "metrics": "Prometheus metrics with promhttp",
        "dashboards": "Grafana dashboards for key metrics",
        "alerting": "Alert on SLO breaches (Alertmanager)"
      },
      "performance": {
        "sla_slo": "Define SLAs (99.9%) and SLOs (P95 < 200ms)",
        "budgets": "Error budgets for risk management",
        "optimization": "Profile with pprof, optimize hot paths"
      },
      "incident_management": {
        "on_call": "On-call rotation with documented runbooks",
        "response": "Incident response procedures, blameless post-mortems",
        "runbooks": "Documented procedures for common issues"
      },
      "cost_optimization": {
        "resource_monitoring": "Monitor cloud costs",
        "cleanup": "Automated resource cleanup",
        "tiered_storage": "Use appropriate storage tiers"
      }
    },
    "compliance": {
      "data_privacy": {
        "gdpr": "Right to access, erasure, portability",
        "ccpa": "California privacy rights"
      },
      "industry_specific": {
        "pci_dss": "Payment card data security",
        "hipaa": "Healthcare data protection",
        "sox": "Financial audit trails"
      },
      "audit": {
        "logging": "Audit logs for security events",
        "reporting": "Compliance reports"
      }
    }
  },
  "questions": [
    {
      "name": "error_tracking_integration",
      "type": "choice",
      "prompt": "Error tracking for production?",
      "choices": ["none", "sentry", "datadog", "custom"],
      "default": "none",
      "hint": "Sentry/Datadog for error tracking in production"
    },
    {
      "name": "deployment_target",
      "type": "choice",
      "prompt": "Deployment target?",
      "choices": ["linux", "kubernetes", "serverless", "multi_platform"],
      "default": "linux",
      "hint": "Affects build tags and platform-specific code"
    },
    {
      "name": "performance_critical",
      "type": "boolean",
      "prompt": "Is this performance-critical?",
      "default": false,
      "hint": "Triggers: benchmarking, profiling, optimization"
    },
    {
      "name": "goroutine_usage",
      "type": "boolean",
      "prompt": "Uses goroutines?",
      "default": false,
      "hint": "Triggers: concurrency docs, race detector guidance"
    },
    {
      "name": "backward_compatibility",
      "type": "boolean",
      "prompt": "Must maintain backward compatibility?",
      "default": true,
      "hint": "Triggers: deprecation warnings, migration guides"
    }
  ],
  "prompts": {
    "code_generation": "Generate production-quality Go code for: {task}\n\nREQUIREMENTS:\n\n1. DOCUMENTATION STRUCTURE (human-first):\n\nHUMAN CONTENT (Top ~80 lines):\n- Package comment: // Package name provides clear description\n- Purpose: What this package does (bold, clear)\n- Quick Start: Copy-paste example showing common usage\n- Exported API: List of exported functions/types\n- Error Handling: Common errors and how to handle them\n- Examples: Real usage patterns with expected output\n\nSEPARATOR:\n---\n## AI Navigation Metadata\n// The sections below provide structured metadata for AI assistants,\n// graph databases (Neo4j), and vector databases (pgvector).\n\nAI METADATA (Below separator):\n- Module Identity (JSON comment block)\n- Architecture Diagram (Mermaid in comment)\n- Call Graph (YAML in comment)\n- Anti-Patterns (Markdown in comment)\n- Search Keywords (comma-separated in comment)\n\n2. CODE QUALITY:\n- Explicit error handling: return (result, error)\n- No panic() in library code\n- Table-driven tests\n- Pass gofmt and golint\n\n3. AI NAVIGATION (in package comment):\n\nModule Identity (JSON):\n```json\n{\n  \"package\": \"package_name\",\n  \"purpose\": \"Clear unique purpose statement\",\n  \"layer\": \"handler|service|repository|domain\",\n  \"go_patterns\": [\"http.Handler\", \"context.Context usage\"],\n  \"related_packages\": [\"net/http\", \"database/sql\"],\n  \"alternatives\": {\n    \"SimilarPkg1\": \"Why use this instead\",\n    \"SimilarPkg2\": \"Why use this instead\"\n  },\n  \"disambiguation\": {\n    \"vs_similar1\": \"Key differences\",\n    \"vs_similar2\": \"Key differences\"\n  }\n}\n```\n\nArchitecture (Mermaid):\n```mermaid\ngraph TB\n    Caller --> ThisPackage\n    ThisPackage --> Dep1\n    ThisPackage --> Dep2\n```\n\nCall Graph (YAML):\n```yaml\ncalls_out:\n  - package: net/http\n    functions: [Get, Post]\n    purpose: HTTP client\n    critical: true\n\ncalled_by:\n  - package: main\n    purpose: Application entry\n    frequency: high\n\ndepends_on:\n  - net/http (standard library)\n  - context (standard library)\n```\n\nAnti-Patterns:\n\u274c DO NOT create duplicate \"pkg_wrapper\" - use this package directly\n\u274c DO NOT ignore errors - always check error returns\n\nSearch Keywords:\ngo-handler, http-server, context-usage, error-handling, production-ready\n\nOUTPUT CODE ONLY (with enhanced documentation)."
  },
  "scoring_weights": {
    "has_package_docs": 1.0,
    "has_function_docs": 1.0,
    "has_tests": 1.0,
    "error_handling": 1.0,
    "gofmt_compliant": 1.0,
    "has_module_identity_json": 0.95,
    "has_architecture_diagram": 0.9,
    "has_call_graph_yaml": 0.9,
    "has_anti_patterns": 0.85,
    "has_search_keywords": 0.8,
    "human_content_first": 0.9,
    "clear_separation": 0.85,
    "ai_metadata_explained": 0.8,
    "graph_db_ready": 0.9,
    "vector_db_optimized": 0.9
  },
  "graph_model": {
    "version": 2,
    "node_types": {
      "package": {
        "id_format": "go://{module_path}",
        "merge_keys": [
          "module_path"
        ]
      },
      "function": {
        "id_format": "go://{module_path}.{function}/{arity}",
        "merge_keys": [
          "signature_hash"
        ]
      }
    },
    "edge_types": {
      "calls": {
        "from": "function",
        "to": "function",
        "weight": 0.85
      },
      "declares": {
        "from": "package",
        "to": "function",
        "weight": 1.0
      }
    },
    "extraction_rules": {
      "function_detection": "go/ast FuncDecl",
      "call_graph": "walk CallExpr; resolve selector expr best-effort",
      "ai_metadata_extraction": "parse JSON/YAML/Mermaid from package comments"
    },
    "temporal": {
      "track": true,
      "fields": [
        "first_seen",
        "last_modified"
      ],
      "update_policy": "touch_last_modified_on_signature_change"
    },
    "error_semantics": {
      "severity_enum": [
        "fatal",
        "transient",
        "validation",
        "resource",
        "logic"
      ],
      "classification_enum": [
        "user_input",
        "system_state",
        "external_dependency",
        "data_integrity"
      ],
      "default_severity": "logic"
    }
  },
  "last_updated": "2025-01-14",
  "scoring_weights": {
    "has_package_docs": 1.0,
    "has_function_docs": 1.0,
    "has_tests": 1.0,
    "error_handling": 1.0,
    "golangci_lint_compliant": 1.0,
    "has_module_identity_json": 0.95,
    "has_architecture_diagram": 0.9,
    "has_call_graph_yaml": 0.9,
    "has_anti_patterns": 0.85,
    "has_search_keywords": 0.8,
    "human_content_first": 0.9,
    "clear_separation": 0.85,
    "ai_metadata_explained": 0.8,
    "graph_db_ready": 0.9,
    "vector_db_optimized": 0.9,
    "has_performance_characteristics": 0.9,
    "has_concurrency_safety_docs": 0.85,
    "has_degradation_patterns": 0.8,
    "has_version_compatibility": 0.85,
    "has_configuration_guide": 0.8,
    "has_observable_metrics": 0.9,
    "has_troubleshooting_guide": 0.75,
    "has_architecture_decisions": 0.7,
    "production_deployment_ready": 0.95,
    "security_reviewed": 0.95
  },
  "parent_pattern": null
}