{
  "name": "Java Production Quality",
  "spec_version": "2.5.0",
  "capabilities": [
    "quality",
    "graph",
    "rag",
    "ai_navigation",
    "graph_db",
    "vector_db"
  ],
  "language": "java",
  "quality_level": "production",
  "description": "Production-grade quality standards for modern Java (17+) with Spring Boot patterns, AI navigation metadata (JSON/YAML/Mermaid) for billion-line codebases, graph DB indexing (Neo4j), and vector DB optimization (pgvector)",
  "changelog": {
    "2.2.0": {
      "date": "2025-01-14",
      "changes": [
        "Added human-first documentation structure (human content top, AI metadata below separator)",
        "Added module_identity JSON for vector DB disambiguation",
        "Added architecture_diagram (Mermaid) for visual understanding",
        "Added call_graph (YAML) for graph DB indexing",
        "Added anti_patterns for duplicate prevention",
        "Added search_keywords for vector search optimization",
        "Enhanced prompts with documentation structure guidance",
        "Added scoring weights for AI-optimized metadata and documentation structure"
      ]
    },
    "2.0": {
      "date": "2025-01-08",
      "changes": [
        "Initial production template for modern Java (17+) with Spring Boot patterns"
      ]
    }
  },
  "requirements": {
    "documentation": {
      "javadoc": {
        "required": true,
        "required_for": [
          "all_public_classes",
          "all_public_methods"
        ],
        "min_length": 100,
        "must_include": [
          "description",
          "@param",
          "@return",
          "@throws",
          "examples",
          "human_content_first",
          "module_identity_json",
          "architecture_diagram",
          "call_graph_metadata",
          "anti_patterns"
        ],
        "ai_navigation": {
          "module_identity": {
            "format": "json",
            "required_fields": [
              "class",
              "purpose",
              "layer",
              "spring_annotations",
              "related_classes",
              "alternatives",
              "disambiguation"
            ],
            "description": "JSON block for vector DB disambiguation and graph DB indexing (Java/Spring-specific)"
          },
          "architecture_diagram": {
            "format": "mermaid",
            "types": [
              "graph",
              "sequence",
              "flowchart"
            ],
            "description": "Visual architecture for AI understanding of call flow and data flow"
          },
          "call_graph": {
            "format": "yaml",
            "required_fields": [
              "calls_out",
              "called_by",
              "depends_on",
              "injection"
            ],
            "description": "Machine-readable call graph for graph DB indexing (Neo4j, etc.)"
          },
          "anti_patterns": {
            "format": "markdown",
            "sections": [
              "duplicate_classes",
              "usage_mistakes",
              "spring_boot_antipatterns"
            ],
            "description": "Explicit duplicate prevention and Spring Boot best practices"
          },
          "search_keywords": {
            "format": "comma_separated",
            "min_count": 5,
            "description": "Keywords for vector search optimization (10+ recommended)"
          }
        }
      }
    },
    "type_safety": {
      "use_optionals": true,
      "avoid_null": true,
      "sealed_classes": "when_appropriate",
      "records": "for_dtos"
    },
    "error_handling": {
      "style": "exceptions_with_hierarchy",
      "custom_exceptions": "required",
      "checked_vs_unchecked": "prefer_unchecked_for_business_logic",
      "try_with_resources": "for_autocloseable"
    },
    "testing": {
      "required": true,
      "framework": "JUnit 5",
      "coverage_target": 85,
      "test_types": [
        "unit",
        "integration",
        "property_based"
      ],
      "mocking": "Mockito"
    },
    "code_style": {
      "naming": "camelCase for methods, PascalCase for classes",
      "max_method_length": 40,
      "max_class_length": 500,
      "immutability": "prefer_final_and_records",
      "dependency_injection": "constructor_injection"
    }
  },
  "semantic_patterns": {
    "common_patterns": [
      {
        "pattern": "REST Controller",
        "pseudocode": "@RestController \u2192 @Autowired Service \u2192 @GetMapping/@PostMapping \u2192 ResponseEntity<T> \u2192 HTTP response",
        "relationships": [
          "Service layer",
          "DTO validation",
          "Exception handlers",
          "Spring Security"
        ],
        "keywords": [
          "controller",
          "rest",
          "api",
          "endpoint",
          "spring"
        ]
      },
      {
        "pattern": "Service Layer",
        "pseudocode": "@Service \u2192 @Transactional \u2192 Repository calls \u2192 business logic \u2192 return DTO",
        "relationships": [
          "Repository pattern",
          "Transaction management",
          "DTOs",
          "Mapping"
        ],
        "keywords": [
          "service",
          "business logic",
          "transaction",
          "repository"
        ]
      },
      {
        "pattern": "Repository Pattern",
        "pseudocode": "interface extends JpaRepository<Entity, ID> \u2192 custom queries with @Query \u2192 Optional<T> returns",
        "relationships": [
          "JPA entities",
          "Database",
          "Optional handling",
          "Specifications"
        ],
        "keywords": [
          "repository",
          "jpa",
          "database",
          "query",
          "entity"
        ]
      },
      {
        "pattern": "Event-Driven",
        "pseudocode": "@EventListener \u2192 handle event \u2192 async processing \u2192 publish new event",
        "relationships": [
          "ApplicationEventPublisher",
          "Async",
          "Transaction boundaries"
        ],
        "keywords": [
          "event",
          "listener",
          "async",
          "publish",
          "domain"
        ]
      }
    ],
    "relationship_vectors": {
      "spring_mvc": "Controller \u2192 Service \u2192 Repository \u2192 Entity \u2192 DB",
      "dto_pattern": "Entity \u2192 Mapper \u2192 DTO \u2192 JSON response",
      "dependency_injection": "@Autowired/@Component \u2192 Spring container \u2192 lifecycle management",
      "transaction_management": "@Transactional \u2192 propagation \u2192 isolation \u2192 rollback rules",
      "async_processing": "@Async \u2192 CompletableFuture \u2192 thread pool \u2192 exception handling",
      "validation": "@Valid \u2192 Bean Validation \u2192 ConstraintValidator \u2192 error messages",
      "security": "SecurityContext \u2192 Authentication \u2192 Authorization \u2192 @PreAuthorize"
    },
    "architectural_hints": {
      "layered": "Controller \u2192 Service \u2192 Repository \u2192 Entity (strict boundaries)",
      "hexagonal": "Domain core \u2192 Ports (interfaces) \u2192 Adapters (implementations)",
      "cqrs": "Command \u2192 CommandHandler \u2192 Event \u2192 EventHandler \u2192 Query \u2192 QueryHandler",
      "event_sourcing": "Command \u2192 Aggregate \u2192 Events \u2192 EventStore \u2192 Projections",
      "microservices": "Service \u2192 REST/gRPC \u2192 Service discovery \u2192 Circuit breaker \u2192 Resilience4j",
      "messaging": "Producer \u2192 Kafka/RabbitMQ \u2192 Consumer \u2192 Dead letter queue"
    },
    "distributed_patterns": {
      "spring_cloud_microservice": {
        "structure": "@SpringBootApplication \u2192 @EnableDiscoveryClient \u2192 Feign clients \u2192 Eureka \u2192 LoadBalanced RestTemplate",
        "relationships": [
          "Service registration with Eureka/Consul",
          "Client-side load balancing",
          "Circuit breaker with Resilience4j",
          "Distributed tracing with Sleuth"
        ],
        "example_flow": "Service A \u2192 Feign client \u2192 Eureka lookup \u2192 Service B instance \u2192 circuit breaker \u2192 fallback"
      },
      "kafka_event_streaming": {
        "structure": "@KafkaListener \u2192 deserialize \u2192 process \u2192 @Transactional \u2192 commit offset",
        "relationships": [
          "Consumer groups for scaling",
          "Idempotency handling",
          "Dead letter topics",
          "Exactly-once semantics"
        ]
      },
      "saga_choreography": {
        "structure": "Service publishes event \u2192 Other services listen \u2192 local transaction \u2192 publish compensating event on failure",
        "relationships": [
          "Event bus (Kafka)",
          "Eventual consistency",
          "Compensation logic",
          "State tracking"
        ]
      }
    },
    "service_relationships": {
      "api_gateway_to_services": "API Gateway (Spring Cloud Gateway) \u2192 route \u2192 backend services \u2192 aggregate responses",
      "service_to_service": "Service A \u2192 Feign/RestTemplate \u2192 Service B \u2192 circuit breaker \u2192 fallback",
      "event_driven_coordination": "Service A \u2192 publish event \u2192 Kafka \u2192 Service B subscribes \u2192 process \u2192 ack",
      "distributed_tracing": "Request \u2192 trace ID \u2192 spans across services \u2192 Zipkin/Jaeger \u2192 observability"
    }
  },
  "prompts": {
    "code_generation": "Generate production-quality Java code for: {task}\n\nREQUIREMENTS:\n\n1. DOCUMENTATION STRUCTURE (human-first):\n\nHUMAN CONTENT (Top ~80 lines in JavaDoc):\n/**\n * Class Name - Brief description\n *\n * <p><b>Purpose:</b> What this class does (clear statement)</p>\n *\n * <h2>Quick Start</h2>\n * <pre>{@code\n * // Copy-paste example\n * MyService service = new MyService(repository);\n * UserDTO user = service.findById(1L);\n * }</pre>\n *\n * <h2>Public API</h2>\n * <ul>\n *   <li>findById(Long) - Find user by ID</li>\n *   <li>create(UserDTO) - Create new user</li>\n * </ul>\n *\n * <h2>Error Handling</h2>\n * <ul>\n *   <li>UserNotFoundException - When user not found</li>\n *   <li>ValidationException - Invalid input data</li>\n * </ul>\n */\n\nSEPARATOR:\n---\n<h2>AI Navigation Metadata</h2>\n<p><i>The sections below provide structured metadata for AI assistants,\ngraph databases (Neo4j), and vector databases (pgvector).</i></p>\n\nAI METADATA (Below separator in JavaDoc):\n- Module Identity (JSON in {@code} block)\n- Architecture Diagram (Mermaid as text)\n- Call Graph (YAML as text)\n- Anti-Patterns (Markdown list)\n- Search Keywords (comma-separated)\n\n2. CODE QUALITY:\n- JavaDoc for all public classes and methods\n- Use Optional<T> instead of null\n- Custom exception hierarchy\n- JUnit 5 tests with Mockito\n- Follow Spring Boot conventions\n- Constructor injection\n- Records for DTOs\n\n3. AI NAVIGATION (in class JavaDoc):\n\nModule Identity (JSON):\n<pre>{@code\n{\n  \"class\": \"com.example.UserService\",\n  \"purpose\": \"User management service with validation\",\n  \"layer\": \"service\",\n  \"spring_annotations\": [\"@Service\", \"@Transactional\"],\n  \"related_classes\": [\"UserRepository\", \"UserDTO\", \"UserMapper\"],\n  \"alternatives\": {\n    \"UserManager\": \"Legacy - use UserService instead\"\n  },\n  \"disambiguation\": {\n    \"vs_UserManager\": \"UserService = Spring-managed, validated. UserManager = legacy\"\n  }\n}\n}</pre>\n\nArchitecture (Mermaid):\n<pre>\ngraph TB\n    Controller[UserController] --> Service[UserService]\n    Service --> Repository[UserRepository]\n    Service --> Mapper[UserMapper]\n    Repository --> Entity[UserEntity]\n</pre>\n\nCall Graph (YAML):\n<pre>\ncalls_out:\n  - class: UserRepository\n    methods: [findById, save]\n    purpose: Database operations\n    critical: true\n\ncalled_by:\n  - class: UserController\n    purpose: REST API endpoint\n    frequency: high\n\ndepends_on:\n  - UserRepository (required)\n  - UserMapper (required)\n\ninjection:\n  type: constructor\n  dependencies: [UserRepository, UserMapper]\n</pre>\n\nAnti-Patterns:\n\u274c DO NOT create UserManager - UserService exists!\n\u274c DO NOT use field injection (@Autowired on fields) - use constructor injection\n\u274c DO NOT return null - use Optional&lt;T&gt;\n\nSearch Keywords:\nspring-service, user-management, jpa-repository, transaction-management, dto-mapping\n\nOUTPUT CODE ONLY (with enhanced JavaDoc).",
    "documentation": "Generate JavaDoc for this Java code:\n\n```java\n{code}\n```\n\nInclude:\n\nHUMAN CONTENT (top):\n- Class-level JavaDoc with description, purpose, quick start, API list, error handling\n- Method-level JavaDoc with @param, @return, @throws\n\nSEPARATOR:\n---\n<h2>AI Navigation Metadata</h2>\n\nAI METADATA (below):\n- Module Identity (JSON)\n- Architecture Diagram (Mermaid)\n- Call Graph (YAML)\n- Anti-Patterns\n- Search Keywords\n\nOUTPUT DOCUMENTATION ONLY.",
    "tests": "Generate JUnit 5 tests for this code:\n\n```java\n{code}\n```\n\nInclude:\n- Unit tests with Mockito\n- Edge cases\n- Exception handling tests\n- Use @ParameterizedTest for multiple scenarios\n\nOUTPUT TEST CODE ONLY."
  },
  "examples": {
    "good_code": "/**\n * Service for managing user operations.\n *\n * <p>Handles user creation, updates, and retrieval with\n * comprehensive validation and error handling.</p>\n *\n * @since 1.0\n */\n@Service\npublic class UserService {\n    private final UserRepository repository;\n    private final UserMapper mapper;\n\n    /**\n     * Creates a new user service.\n     *\n     * @param repository the user repository\n     * @param mapper the user mapper\n     */\n    public UserService(UserRepository repository, UserMapper mapper) {\n        this.repository = repository;\n        this.mapper = mapper;\n    }\n\n    /**\n     * Finds a user by ID.\n     *\n     * @param id the user ID\n     * @return the user if found\n     * @throws UserNotFoundException if user doesn't exist\n     */\n    @Transactional(readOnly = true)\n    public UserDTO findById(Long id) {\n        return repository.findById(id)\n            .map(mapper::toDTO)\n            .orElseThrow(() -> new UserNotFoundException(id));\n    }\n}",
    "bad_code": "// No JavaDoc\n@Service\npublic class UserService {\n    @Autowired  // Field injection - bad!\n    private UserRepository repository;\n\n    // No JavaDoc, returns null - bad!\n    public UserDTO findById(Long id) {\n        UserEntity entity = repository.findById(id).orElse(null);\n        return entity != null ? mapper.toDTO(entity) : null;  // Null return!\n    }\n}"
  },
  "quality_checklist": [
    "Has JavaDoc for all public classes and methods",
    "Uses Optional<T> instead of null returns",
    "Custom exception hierarchy defined",
    "JUnit 5 tests with >85% coverage",
    "Constructor injection (not field injection)",
    "Immutable DTOs using records",
    "@Transactional where appropriate",
    "Proper exception handling",
    "No code smells (long methods, god classes)",
    "AI navigation metadata present (JSON/YAML/Mermaid)",
    "Human content first, AI metadata below separator"
  ],
  "scoring_weights": {
    "has_javadoc": 1.0,
    "uses_optional": 0.9,
    "has_tests": 1.0,
    "uses_records": 0.7,
    "constructor_injection": 0.8,
    "transaction_management": 0.9,
    "exception_handling": 1.0,
    "has_module_identity_json": 0.95,
    "has_architecture_diagram": 0.9,
    "has_call_graph_yaml": 0.9,
    "has_anti_patterns": 0.85,
    "has_search_keywords": 0.8,
    "human_content_first": 0.9,
    "clear_separation": 0.85,
    "ai_metadata_explained": 0.8,
    "graph_db_ready": 0.9,
    "vector_db_optimized": 0.9
  },
  "graph_model": {
    "version": 2,
    "node_types": {
      "package": {
        "id_format": "java://{package_path}",
        "merge_keys": [
          "package_path"
        ]
      },
      "class": {
        "id_format": "java://{package_path}.{class_name}",
        "merge_keys": [
          "package_path",
          "class_name"
        ]
      },
      "method": {
        "id_format": "java://{package_path}.{class_name}.{method}/{arity}",
        "merge_keys": [
          "signature_hash"
        ]
      }
    },
    "edge_types": {
      "calls": {
        "from": "method",
        "to": "method",
        "weight": 0.9
      },
      "contains": {
        "from": "package",
        "to": "class",
        "weight": 1.0
      },
      "defines": {
        "from": "class",
        "to": "method",
        "weight": 1.0
      }
    },
    "extraction_rules": {
      "method_detection": "parse using Java parser (e.g. Eclipse JDT or tree-sitter)",
      "call_graph": "walk method invocation expressions",
      "ai_metadata_extraction": "parse JSON/YAML/Mermaid from JavaDoc comments"
    },
    "temporal": {
      "track": true,
      "fields": [
        "first_seen",
        "last_modified"
      ],
      "update_policy": "touch_last_modified_on_signature_change"
    },
    "error_semantics": {
      "severity_enum": [
        "fatal",
        "transient",
        "validation",
        "resource",
        "logic"
      ],
      "classification_enum": [
        "user_input",
        "system_state",
        "external_dependency",
        "data_integrity"
      ],
      "default_severity": "logic"
    }
  },
  "last_updated": "2025-01-14",
  "parent_pattern": null
}