{
  "name": "TSX Component Production Quality",
  "spec_version": "2.6.0",
  "capabilities": [
    "quality",
    "graph",
    "rag",
    "ai_navigation",
    "graph_db",
    "vector_db"
  ],
  "language": "typescript_tsx",
  "quality_level": "production",
  "description": "Production-grade quality standards for React/TSX components with AI navigation metadata (JSON/YAML/Mermaid) for billion-line codebases, focus on accessibility, stability, and composability",
  "changelog": {
    "2.6.0": {
      "date": "2025-10-26",
      "changes": [
        "Added 6 gold standard production sections for true production readiness",
        "Security section: authentication, authorization, input validation, cryptography, OWASP, headers, API security",
        "Deployment section: containerization, CI/CD, infrastructure, health checks, scaling, DR",
        "API Design section: REST, GraphQL, versioning, OpenAPI documentation",
        "Data Persistence section: migrations, transactions, caching, event sourcing, retention",
        "Operational Excellence section: monitoring, SLA/SLO, incident management, cost optimization",
        "Compliance section: GDPR, CCPA, PCI DSS, HIPAA, SOX, audit logging",
        "Non-breaking: v2.5.0 modules remain valid, new sections are strongly recommended for production"
      ]
    },
    "2.5.0": {
      "date": "2025-10-24",
      "changes": [
        "Added 8 production readiness sections for production operations knowledge",
        "Sections: Performance Characteristics, Concurrency & Safety, Graceful Degradation, Version Compatibility, Configuration Guide, Observable Metrics, Troubleshooting, Architecture Decisions (ADR)",
        "Added 5 new interactive questions: error_tracking_integration, deployment_target, performance_critical, accessibility_wcag, backward_compatibility",
        "Added 10 new scoring weights for production readiness assessment",
        "Non-breaking: v2.4.0 modules remain valid, v2.5.0 sections are optional but recommended for production",
        "Tier-based implementation: Tier 1 (Performance, Metrics, Troubleshooting, Safety), Tier 2 (Config, Degradation, Compatibility), Tier 3 (ADR, Decisions)"
      ]
    },
    "2.3.0": {
      "date": "2025-01-14",
      "changes": [
        "Integrated self-awareness protocol for agent evolution",
        "Added documentation-first development requirements",
        "Enhanced duplicate prevention and architecture understanding",
        "Multi-language coordination with Elixir and Rust"
      ]
    },
    "2.2.0": {
      "date": "2025-01-14",
      "changes": [
        "Added human-first documentation structure (human content top, AI metadata below separator)",
        "Added component_identity JSON for vector DB disambiguation",
        "Added architecture_diagram (Mermaid) for component hierarchy visualization",
        "Added call_graph (YAML) for graph DB indexing (renders, uses_hook)",
        "Added anti_patterns for duplicate prevention and React best practices",
        "Added search_keywords for vector search optimization",
        "Enhanced prompts with documentation structure guidance",
        "Added scoring weights for AI-optimized metadata and documentation structure"
      ]
    },
    "2.0": {
      "date": "2025-01-08",
      "changes": [
        "Initial production template for React/TSX components with accessibility focus"
      ]
    }
  },
  "requirements": {
    "documentation": {
      "component_jsdoc": {
        "required": true,
        "min_length": 100,
        "must_include": [
          "description",
          "props",
          "examples",
          "accessibility",
          "human_content_first",
          "component_identity_json",
          "architecture_diagram",
          "call_graph_metadata",
          "anti_patterns"
        ],
        "should_include_v2_5_0": [
          "performance_characteristics",
          "concurrency_safety",
          "observable_metrics",
          "troubleshooting_guide",
          "graceful_degradation",
          "version_compatibility",
          "configuration_guide",
          "architecture_decisions"
        ],
        "ai_navigation": {
          "component_identity": {
            "format": "json",
            "required_fields": [
              "component",
              "purpose",
              "layer",
              "react_patterns",
              "related_components",
              "alternatives",
              "disambiguation"
            ],
            "description": "JSON block for vector DB disambiguation and graph DB indexing (React/TSX-specific)"
          },
          "architecture_diagram": {
            "format": "mermaid",
            "types": [
              "graph",
              "flowchart"
            ],
            "description": "Visual component hierarchy and hook usage for AI understanding"
          },
          "call_graph": {
            "format": "yaml",
            "required_fields": [
              "renders",
              "rendered_by",
              "uses_hooks",
              "depends_on"
            ],
            "description": "Machine-readable component graph for graph DB indexing (Neo4j, etc.)"
          },
          "anti_patterns": {
            "format": "markdown",
            "sections": [
              "duplicate_components",
              "usage_mistakes",
              "react_antipatterns",
              "a11y_violations"
            ],
            "description": "Explicit duplicate prevention and React/accessibility best practices"
          },
          "search_keywords": {
            "format": "comma_separated",
            "min_count": 5,
            "description": "Keywords for vector search optimization (10+ recommended)"
          },
          "performance_characteristics": {
            "format": "markdown",
            "when": "component has measurable render behavior",
            "should_include": [
              "render_count_typical",
              "memory_footprint",
              "re_render_triggers",
              "benchmarks",
              "optimization_techniques"
            ],
            "description": "Performance characteristics for production deployment decisions (React DevTools Profiler)"
          },
          "concurrency_safety": {
            "format": "markdown",
            "when": "component has async operations or state updates",
            "should_include": [
              "race_condition_risks",
              "state_update_batching",
              "concurrent_rendering",
              "cleanup_requirements",
              "recommended_usage_patterns"
            ],
            "description": "Concurrency and safety guarantees for React 18+ concurrent features"
          },
          "observable_metrics": {
            "format": "markdown",
            "when": "component emits analytics or logs",
            "should_include": [
              "analytics_events",
              "error_boundaries",
              "performance_marks",
              "user_interaction_tracking",
              "example_dashboards"
            ],
            "description": "Documented analytics events and monitoring guidance"
          },
          "troubleshooting_guide": {
            "format": "markdown",
            "when": "component might encounter runtime issues",
            "should_include": [
              "common_problems",
              "root_causes",
              "diagnostic_steps",
              "solutions",
              "react_devtools_usage",
              "prevention_strategies"
            ],
            "description": "Common issues, diagnostics, and solutions for production debugging"
          },
          "graceful_degradation": {
            "format": "markdown",
            "when": "component has external dependencies or data loading",
            "should_include": [
              "failure_scenarios",
              "fallback_ui",
              "error_boundary_usage",
              "loading_states",
              "recovery_mechanism"
            ],
            "description": "Failure modes and degradation patterns for fault tolerance (Suspense + ErrorBoundary)"
          },
          "version_compatibility": {
            "format": "markdown",
            "when": "component has dependencies or breaking history",
            "should_include": [
              "react_versions_supported",
              "typescript_versions",
              "key_dependencies",
              "breaking_changes_history",
              "migration_guide"
            ],
            "description": "Version compatibility matrix and breaking changes documentation"
          },
          "configuration_guide": {
            "format": "markdown",
            "when": "component has configurable behavior",
            "should_include": [
              "props_reference",
              "theme_customization",
              "css_variables",
              "feature_flags",
              "accessibility_options"
            ],
            "description": "Configuration options and customization guidance"
          },
          "architecture_decisions": {
            "format": "markdown",
            "when": "component has non-obvious design choices",
            "should_include": [
              "decision_id",
              "problem_statement",
              "alternatives_considered",
              "chosen_solution_and_rationale",
              "consequences",
              "related_decisions"
            ],
            "description": "Architecture Decision Records (ADR) explaining design rationale"
          }
        }
      }
    },
    "props": {
      "explicit_interface": true,
      "no_any": true,
      "prefer_discriminated_unions": true
    },
    "a11y": {
      "required": true,
      "must_address": [
        "aria-labels",
        "focus-order",
        "keyboard-nav"
      ]
    },
    "testing": {
      "framework": "vitest + @testing-library/react",
      "required": true,
      "coverage_target": 85,
      "test_types": [
        "behavior",
        "a11y",
        "snapshot_optional"
      ]
    },
    "performance": {
      "guidelines": [
        "avoid inline functions in hot lists",
        "memoize expensive renders"
      ],
      "metrics": [
        "render_count",
        "hook_allocation"
      ]
    },
    "security": {
      "authentication": {
        "jwt_handling": "Store JWT in httpOnly cookies, not localStorage",
        "oauth2_flows": "Use libraries like next-auth for OAuth flows",
        "api_keys": "Never expose API keys in client-side code",
        "session_management": "Use secure session storage, CSRF tokens"
      },
      "authorization": {
        "rbac": "Implement client-side RBAC for UI, verify server-side",
        "permissions": "Validate permissions before rendering sensitive UI",
        "audit_logging": "Log security events (login, logout, permission changes)"
      },
      "input_validation": {
        "sanitization": "Use DOMPurify for user-generated HTML, validate all inputs",
        "rate_limiting": "Implement client-side debouncing, server enforces limits",
        "file_uploads": "Validate file types, size limits before upload"
      },
      "cryptography": {
        "password_hashing": "Never hash passwords client-side, use server-side bcrypt/argon2",
        "encryption": "Use Web Crypto API for client-side encryption if needed",
        "secrets": "Never hardcode secrets, use environment variables"
      },
      "owasp_compliance": {
        "injection": "Prevent XSS with React auto-escaping, avoid dangerouslySetInnerHTML",
        "broken_auth": "Implement secure authentication flows, MFA support",
        "sensitive_data": "Don't store sensitive data in browser storage",
        "xss": "Use Content Security Policy, sanitize user input",
        "broken_access": "Validate permissions client and server-side",
        "security_misconfig": "Use security headers, disable source maps in production",
        "vulnerable_deps": "Run npm audit, Snyk regularly",
        "logging": "Don't log sensitive data, sanitize error messages"
      },
      "security_headers": {
        "csp": "Content-Security-Policy: script-src 'self'",
        "hsts": "Set via server (Next.js, Express)",
        "x_frame_options": "X-Frame-Options: DENY",
        "x_content_type": "X-Content-Type-Options: nosniff",
        "referrer_policy": "Referrer-Policy: no-referrer"
      },
      "api_security": {
        "rate_limiting": "Client-side debouncing, server-side rate limits",
        "cors": "Configure CORS on server, validate origins",
        "webhooks": "Validate webhook signatures on server",
        "idempotency": "Use idempotency keys for critical operations"
      }
    },
    "deployment": {
      "containerization": {
        "docker": {
          "multi_stage": "Multi-stage builds with Node.js, nginx for static files",
          "non_root": "Run as non-root user",
          "security_scanning": "Scan with Trivy, Snyk"
        },
        "kubernetes": {
          "resource_limits": "Set CPU/memory limits for Node.js",
          "network_policies": "Implement pod network policies",
          "secrets": "Use Kubernetes Secrets for environment variables"
        }
      },
      "ci_cd": {
        "pipeline_stages": "Build -> Test -> Lint -> Security Scan -> Deploy",
        "testing": "Unit (Vitest), integration, E2E (Playwright, Cypress)",
        "quality_gates": "Coverage 85%+, ESLint pass, security scan clear",
        "deployment_strategies": "Blue-green, canary with Next.js, Vercel"
      },
      "infrastructure": {
        "health_checks": "Health check endpoint for SSR apps",
        "scaling": "CDN for static assets, autoscaling for SSR",
        "observability": "Web Vitals, error tracking (Sentry), analytics",
        "disaster_recovery": "CDN failover, multi-region deployment"
      }
    },
    "api_design": {
      "rest": {
        "url_structure": "RESTful API calls with versioning",
        "pagination": "Infinite scroll or cursor-based pagination",
        "filtering": "Query params for filtering",
        "sorting": "Sort query param support"
      },
      "graphql": {
        "schema": "Use Apollo Client or urql for GraphQL",
        "rate_limiting": "Query complexity analysis on server",
        "subscriptions": "WebSocket subscriptions for real-time"
      },
      "versioning": {
        "deprecation": "Show deprecation warnings in UI",
        "backward_compatibility": "Support legacy API versions"
      },
      "documentation": {
        "openapi": "Document API contracts with OpenAPI",
        "examples": "Include usage examples in Storybook",
        "error_codes": "Document error states and handling"
      }
    },
    "data_persistence": {
      "database": {
        "migrations": "Handle via backend API",
        "transactions": "Use backend transactions",
        "optimization": "Optimize API queries, minimize requests"
      },
      "caching": {
        "strategies": "React Query, SWR for client-side caching",
        "invalidation": "Time-based or mutation-based invalidation",
        "distributed_cache": "Use CDN for static assets, API cache on server"
      },
      "event_sourcing": {
        "when_applicable": "Client-side event tracking, analytics",
        "event_store": "Send events to analytics service",
        "projections": "Build UI state from events"
      },
      "data_retention": {
        "policies": "Clear local storage periodically",
        "archival": "Archive old data on server",
        "gdpr_compliance": "Right to erasure, data export via API"
      }
    },
    "operational_excellence": {
      "monitoring": {
        "golden_signals": "Core Web Vitals (LCP, FID, CLS), error rate",
        "metrics": "Custom metrics with analytics, RUM",
        "dashboards": "Analytics dashboards (Google Analytics, Mixpanel)",
        "alerting": "Alert on high error rates, performance degradation"
      },
      "performance": {
        "sla_slo": "Define performance budgets (LCP < 2.5s, FID < 100ms)",
        "budgets": "Performance budgets for bundle size, load time",
        "optimization": "Code splitting, lazy loading, image optimization"
      },
      "incident_management": {
        "on_call": "On-call rotation with runbooks",
        "response": "Incident response for production issues",
        "runbooks": "Document common UI issues"
      },
      "cost_optimization": {
        "resource_monitoring": "Monitor CDN costs, API usage",
        "cleanup": "Remove unused dependencies, optimize bundle",
        "tiered_storage": "Use CDN tiers appropriately"
      }
    },
    "compliance": {
      "data_privacy": {
        "gdpr": "Cookie consent, data export, right to erasure",
        "ccpa": "California privacy notice, opt-out"
      },
      "industry_specific": {
        "pci_dss": "Don't store card data client-side, use tokenization",
        "hipaa": "Encrypt health data, secure transmission",
        "sox": "Audit trails for financial data access"
      },
      "audit": {
        "logging": "Client-side error tracking, user action logging",
        "reporting": "Analytics reports, compliance dashboards"
      }
    }
  },
  "questions": [
    {
      "name": "error_tracking_integration",
      "type": "choice",
      "prompt": "Error tracking integration for production monitoring?",
      "choices": [
        "none",
        "sentry",
        "datadog",
        "custom"
      ],
      "default": "none",
      "hint": "Sentry/Datadog integration for automatic error tracking with React ErrorBoundary"
    },
    {
      "name": "deployment_target",
      "type": "choice",
      "prompt": "Deployment target?",
      "choices": [
        "browser",
        "server_side_rendering",
        "static_export",
        "hybrid"
      ],
      "default": "browser",
      "hint": "Browser for SPA, SSR for Next.js/Remix, static for prerendering, hybrid for both"
    },
    {
      "name": "performance_critical",
      "type": "boolean",
      "prompt": "Is this a performance-critical component?",
      "default": false,
      "hint": "Triggers: React.memo, useMemo, useCallback, virtualization, profiling"
    },
    {
      "name": "accessibility_wcag",
      "type": "choice",
      "prompt": "WCAG accessibility level target?",
      "choices": [
        "none",
        "wcag_a",
        "wcag_aa",
        "wcag_aaa"
      ],
      "default": "wcag_aa",
      "hint": "WCAG AA is standard for most apps, AAA for government/healthcare"
    },
    {
      "name": "backward_compatibility",
      "type": "boolean",
      "prompt": "Must maintain backward compatibility?",
      "default": true,
      "hint": "Triggers: deprecation warnings, migration guides, version matrix documentation"
    }
  ],
  "prompts": {
    "code_generation": "Generate production-quality React/TSX component for: {task}\n\nREQUIREMENTS:\n\n1. DOCUMENTATION STRUCTURE (human-first):\n\nHUMAN CONTENT (Top ~80 lines in JSDoc):\n/**\n * Component Name - Brief description\n *\n * **Purpose:** What this component does (clear statement)\n *\n * ## Quick Start\n * ```tsx\n * import { MyComponent } from './MyComponent';\n *\n * function App() {\n *   return <MyComponent name=\"example\" />;\n * }\n * ```\n *\n * ## Props\n * - `name` (string, required) - Display name\n * - `onClick` (function, optional) - Click handler\n *\n * ## Accessibility\n * - ARIA labels for screen readers\n * - Keyboard navigation support\n * - Focus management\n *\n * ## Examples\n * ```tsx\n * // Basic usage\n * <MyComponent name=\"John\" />\n *\n * // With event handler\n * <MyComponent name=\"Jane\" onClick={handleClick} />\n * ```\n */\n\nSEPARATOR:\n---\n## AI Navigation Metadata\n// The sections below provide structured metadata for AI assistants,\n// graph databases (Neo4j), and vector databases (pgvector).\n\nAI METADATA (Below separator in JSDoc):\n- Component Identity (JSON in code block)\n- Architecture Diagram (Mermaid - component tree)\n- Call Graph (YAML - renders, hooks)\n- Anti-Patterns (Markdown list)\n- Search Keywords (comma-separated)\n\n2. CODE QUALITY:\n- TypeScript interface for props (no any)\n- Accessibility (aria-labels, keyboard nav)\n- Vitest + @testing-library/react tests\n- Memoization for expensive renders\n- No inline functions in lists\n\n3. AI NAVIGATION (in component JSDoc):\n\nComponent Identity (JSON):\n```json\n{\n  \"component\": \"MyComponent\",\n  \"purpose\": \"Clear unique purpose statement\",\n  \"layer\": \"page|layout|component|hook\",\n  \"react_patterns\": [\"useState\", \"useEffect\", \"custom hooks\"],\n  \"related_components\": [\"ParentComponent\", \"ChildComponent\"],\n  \"alternatives\": {\n    \"OldComponent\": \"Legacy - use this component instead\",\n    \"SimilarComponent\": \"Different use case - see disambiguation\"\n  },\n  \"disambiguation\": {\n    \"vs_OldComponent\": \"This = TypeScript + hooks. OldComponent = class component\",\n    \"vs_SimilarComponent\": \"This = form input. SimilarComponent = display only\"\n  }\n}\n```\n\nArchitecture (Mermaid):\n```mermaid\ngraph TB\n    App[App] --> MyComponent[MyComponent]\n    MyComponent --> Button[Button]\n    MyComponent --> Input[Input]\n    MyComponent -.uses.-> useCustomHook[useCustomHook]\n```\n\nCall Graph (YAML):\n```yaml\nrenders:\n  - component: Button\n    purpose: Submit action\n    critical: true\n  - component: Input\n    purpose: User input\n    critical: true\n\nrendered_by:\n  - component: App\n    purpose: Main application\n    frequency: high\n\nuses_hooks:\n  - useState (React)\n  - useEffect (React)\n  - useCustomHook (custom)\n\ndepends_on:\n  - react (required)\n  - react-dom (required)\n```\n\nAnti-Patterns:\n\u274c DO NOT create 'MyComponentWrapper' - use this component directly\n\u274c DO NOT use inline arrow functions in map() - memoize instead\n\u274c DO NOT forget aria-label - accessibility required\n\u274c DO NOT use 'any' type - explicit interfaces required\n\nSearch Keywords:\nreact-component, typescript-tsx, accessibility, hooks, production-ready, a11y\n\nOUTPUT CODE ONLY (with enhanced JSDoc)."
  },
  "scoring_weights": {
    "has_component_jsdoc": 1.0,
    "has_tests": 1.0,
    "a11y_compliant": 1.0,
    "typescript_strict": 1.0,
    "no_any_type": 0.9,
    "has_component_identity_json": 0.95,
    "has_architecture_diagram": 0.9,
    "has_call_graph_yaml": 0.9,
    "has_anti_patterns": 0.85,
    "has_search_keywords": 0.8,
    "human_content_first": 0.9,
    "clear_separation": 0.85,
    "ai_metadata_explained": 0.8,
    "graph_db_ready": 0.9,
    "vector_db_optimized": 0.9,
    "has_performance_characteristics": 0.9,
    "has_concurrency_safety_docs": 0.85,
    "has_degradation_patterns": 0.8,
    "has_version_compatibility": 0.85,
    "has_configuration_guide": 0.8,
    "has_observable_metrics": 0.9,
    "has_troubleshooting_guide": 0.75,
    "has_architecture_decisions": 0.7,
    "production_deployment_ready": 0.95,
    "security_reviewed": 0.95
  },
  "graph_model": {
    "version": 2,
    "node_types": {
      "component": {
        "id_format": "tsx://{path}#{component}",
        "merge_keys": [
          "component"
        ]
      },
      "hook": {
        "id_format": "tsx://{path}#hook/{name}",
        "merge_keys": [
          "name"
        ]
      }
    },
    "edge_types": {
      "renders": {
        "from": "component",
        "to": "component",
        "weight": 0.6
      },
      "uses_hook": {
        "from": "component",
        "to": "hook",
        "weight": 0.9
      }
    },
    "extraction_rules": {
      "component_detection": "export function | const Name: React.FC",
      "hook_detection": "function names starting with use",
      "a11y_flags": "scan JSX props for aria-*",
      "ai_metadata_extraction": "parse JSON/YAML/Mermaid from JSDoc comments"
    },
    "temporal": {
      "track": true,
      "fields": [
        "first_seen",
        "last_modified"
      ],
      "update_policy": "touch_last_modified_on_signature_change"
    },
    "error_semantics": {
      "severity_enum": [
        "fatal",
        "transient",
        "validation"
      ],
      "classification_enum": [
        "user_input",
        "external_dependency"
      ],
      "default_severity": "validation"
    }
  },
  "last_updated": "2025-01-14",
  "parent_pattern": null
}