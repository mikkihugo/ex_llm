{
  "name": "JavaScript Production Quality",
  "spec_version": "2.6.0",
  "capabilities": [
    "quality",
    "graph",
    "rag",
    "ai_navigation",
    "graph_db",
    "vector_db"
  ],
  "language": "javascript",
  "quality_level": "production",
  "description": "Production-grade quality standards for modern JavaScript (ES2022+) with AI navigation metadata (JSON/YAML/Mermaid) for billion-line codebases, graph DB indexing (Neo4j), and vector DB optimization (pgvector)",
  "changelog": {
    "2.6.0": {
      "date": "2025-10-26",
      "changes": [
        "Added 6 gold standard production sections for true production readiness",
        "Security section: authentication, authorization, input validation, cryptography, OWASP, headers, API security",
        "Deployment section: containerization, CI/CD, infrastructure, health checks, scaling, DR",
        "API Design section: REST, GraphQL, versioning, OpenAPI documentation",
        "Data Persistence section: migrations, transactions, caching, event sourcing, retention",
        "Operational Excellence section: monitoring, SLA/SLO, incident management, cost optimization",
        "Compliance section: GDPR, CCPA, PCI DSS, HIPAA, SOX, audit logging",
        "Non-breaking: v2.5.0 modules remain valid, new sections are strongly recommended for production"
      ]
    },
    "2.5.0": {
      "date": "2025-10-24",
      "changes": [
        "Added 8 production readiness sections for production operations knowledge",
        "Sections: Performance Characteristics, Concurrency & Safety, Graceful Degradation, Version Compatibility, Configuration Guide, Observable Metrics, Troubleshooting, Architecture Decisions (ADR)",
        "Added 5 new interactive questions: error_tracking_integration, deployment_target, performance_critical, multi_environment, backward_compatibility",
        "Added 10 new scoring weights for production readiness assessment",
        "Non-breaking: v2.4.0 modules remain valid, v2.5.0 sections are optional but recommended for production",
        "Tier-based implementation: Tier 1 (Performance, Metrics, Troubleshooting, Safety), Tier 2 (Config, Degradation, Compatibility), Tier 3 (ADR, Decisions)"
      ]
    },
    "2.2.0": {
      "date": "2025-01-14",
      "changes": [
        "Added human-first documentation structure (human content top, AI metadata below separator)",
        "Added module_identity JSON for vector DB disambiguation",
        "Added architecture_diagram (Mermaid) for visual understanding",
        "Added call_graph (YAML) for graph DB indexing",
        "Added anti_patterns for duplicate prevention",
        "Added search_keywords for vector search optimization",
        "Enhanced prompts with documentation structure guidance",
        "Added scoring weights for AI-optimized metadata and documentation structure"
      ]
    },
    "2.0": {
      "date": "2025-01-08",
      "changes": [
        "Initial production template for modern JavaScript (ES2022+)"
      ]
    }
  },
  "requirements": {
    "documentation": {
      "jsdoc": {
        "required": true,
        "required_for": [
          "all_public_functions"
        ],
        "min_length": 100,
        "must_include": [
          "description",
          "params",
          "returns",
          "examples",
          "human_content_first",
          "module_identity_json",
          "architecture_diagram",
          "call_graph_metadata",
          "anti_patterns"
        ],
        "should_include_v2_5_0": [
          "performance_characteristics",
          "concurrency_safety",
          "observable_metrics",
          "troubleshooting_guide",
          "graceful_degradation",
          "version_compatibility",
          "configuration_guide",
          "architecture_decisions"
        ],
        "ai_navigation": {
          "module_identity": {
            "format": "json",
            "required_fields": [
              "module",
              "purpose",
              "layer",
              "export_type",
              "related_modules",
              "alternatives",
              "disambiguation"
            ],
            "description": "JSON block for vector DB disambiguation and graph DB indexing (JavaScript-specific)"
          },
          "architecture_diagram": {
            "format": "mermaid",
            "types": [
              "graph",
              "sequence",
              "flowchart"
            ],
            "description": "Visual architecture for AI understanding of call flow and data flow"
          },
          "call_graph": {
            "format": "yaml",
            "required_fields": [
              "calls_out",
              "called_by",
              "depends_on"
            ],
            "description": "Machine-readable call graph for graph DB indexing (Neo4j, etc.)"
          },
          "anti_patterns": {
            "format": "markdown",
            "sections": [
              "duplicate_modules",
              "usage_mistakes",
              "common_pitfalls"
            ],
            "description": "Explicit duplicate prevention and JavaScript best practices"
          },
          "search_keywords": {
            "format": "comma_separated",
            "min_count": 10,
            "description": "Keywords for vector search optimization (10+ recommended)"
          },
          "performance_characteristics": {
            "format": "markdown",
            "when": "module has measurable computational behavior",
            "should_include": [
              "time_complexity",
              "space_complexity",
              "typical_latencies",
              "benchmarks"
            ],
            "description": "Performance characteristics for production deployment decisions"
          },
          "concurrency_safety": {
            "format": "markdown",
            "when": "module has async operations or shared state",
            "should_include": [
              "promise_safety",
              "callback_safety",
              "race_condition_risks",
              "concurrency_limits",
              "recommended_usage_patterns"
            ],
            "description": "Concurrency and safety guarantees for async code"
          },
          "observable_metrics": {
            "format": "markdown",
            "when": "module emits metrics or logs",
            "should_include": [
              "log_messages",
              "metrics_emitted",
              "trace_points",
              "example_dashboards"
            ],
            "description": "Documented logging, metrics, and observability guidance"
          },
          "troubleshooting_guide": {
            "format": "markdown",
            "when": "module might encounter runtime issues",
            "should_include": [
              "common_problems",
              "root_causes",
              "diagnostic_steps",
              "solutions"
            ],
            "description": "Common issues, diagnostics, and solutions for production debugging"
          },
          "graceful_degradation": {
            "format": "markdown",
            "when": "module has external dependencies",
            "should_include": [
              "failure_scenarios",
              "fallback_behavior",
              "retry_strategy",
              "recovery_mechanism"
            ],
            "description": "Failure modes and degradation patterns for fault tolerance"
          },
          "version_compatibility": {
            "format": "markdown",
            "when": "module has dependencies",
            "should_include": [
              "node_versions_supported",
              "key_dependencies",
              "breaking_changes_history",
              "migration_guide"
            ],
            "description": "Version compatibility matrix and breaking changes documentation"
          },
          "configuration_guide": {
            "format": "markdown",
            "when": "module has configurable behavior",
            "should_include": [
              "environment_variables",
              "runtime_options",
              "tuning_recommendations",
              "safety_constraints"
            ],
            "description": "Configuration options and runtime tuning guidance"
          },
          "architecture_decisions": {
            "format": "markdown",
            "when": "module has non-obvious design choices",
            "should_include": [
              "decision_id",
              "problem_statement",
              "alternatives_considered",
              "chosen_solution_and_rationale",
              "consequences"
            ],
            "description": "Architecture Decision Records (ADR) explaining design rationale"
          }
        }
      }
    },
    "error_handling": {
      "style": "exceptions_or_result_objects",
      "recommended_pattern": "return { ok: true, value } / { ok: false, error }",
      "custom_error_classes": true
    },
    "testing": {
      "required": true,
      "framework": "vitest or jest",
      "coverage_target": 80,
      "test_types": [
        "unit",
        "integration"
      ]
    },
    "code_style": {
      "formatter": "prettier",
      "linter": "eslint",
      "prefer_const": true,
      "no_var": true
    },
    "security": {
      "authentication": {
        "jwt_handling": "Use secure JWT libraries (jsonwebtoken), proper secret rotation",
        "oauth2_flows": "Implement OAuth2 flows securely (authorization code, PKCE)",
        "api_keys": "Store API keys in environment variables, never in code",
        "session_management": "Use secure session storage (Redis, signed cookies), CSRF tokens"
      },
      "authorization": {
        "rbac": "Implement role-based access control with proper permission checks",
        "permissions": "Validate user permissions before operations",
        "audit_logging": "Log all security-relevant events with context"
      },
      "input_validation": {
        "sanitization": "Sanitize all user inputs (XSS prevention, SQL injection)",
        "rate_limiting": "Implement rate limiting (express-rate-limit, Redis)",
        "file_uploads": "Validate file types, size limits, scan for malware"
      },
      "cryptography": {
        "password_hashing": "Use bcrypt or argon2 for password hashing (min 12 rounds)",
        "encryption": "Use crypto module for encryption (AES-256-GCM)",
        "secrets": "Use secrets manager (AWS Secrets Manager, Vault), never hardcode"
      },
      "owasp_compliance": {
        "injection": "Parameterized queries, input validation",
        "broken_auth": "Multi-factor authentication, secure session management",
        "sensitive_data": "Encrypt sensitive data at rest and in transit (TLS 1.3)",
        "xxe": "Disable XML external entities",
        "broken_access": "Enforce authorization checks",
        "security_misconfig": "Secure defaults, remove debug endpoints",
        "xss": "Content Security Policy, input sanitization",
        "deserialization": "Avoid deserializing untrusted data",
        "vulnerable_deps": "npm audit, Snyk scanning",
        "logging": "Don't log sensitive data"
      },
      "security_headers": {
        "csp": "Content-Security-Policy: default-src 'self'",
        "hsts": "Strict-Transport-Security: max-age=31536000",
        "x_frame_options": "X-Frame-Options: DENY",
        "x_content_type": "X-Content-Type-Options: nosniff",
        "referrer_policy": "Referrer-Policy: no-referrer"
      },
      "api_security": {
        "rate_limiting": "Rate limit API endpoints (per-user, per-IP)",
        "cors": "Configure CORS properly, whitelist domains",
        "webhooks": "Validate webhook signatures (HMAC)",
        "idempotency": "Use idempotency keys for critical operations"
      }
    },
    "deployment": {
      "containerization": {
        "docker": {
          "multi_stage": "Use multi-stage builds to minimize image size",
          "non_root": "Run as non-root user (USER node)",
          "security_scanning": "Scan images with Trivy, Snyk"
        },
        "kubernetes": {
          "resource_limits": "Set CPU/memory requests and limits",
          "network_policies": "Implement network policies for pod isolation",
          "secrets": "Use Kubernetes Secrets or external secrets manager"
        }
      },
      "ci_cd": {
        "pipeline_stages": "Build -> Test -> Security Scan -> Deploy",
        "testing": "Unit, integration, E2E tests in CI",
        "quality_gates": "Code coverage (80%+), security scan pass, linting",
        "deployment_strategies": "Blue-green, canary, rolling updates"
      },
      "infrastructure": {
        "health_checks": "Liveness and readiness probes",
        "scaling": "Horizontal pod autoscaling based on metrics",
        "observability": "Metrics (Prometheus), logs (ELK), traces (Jaeger)",
        "disaster_recovery": "Automated backups, multi-region deployment"
      }
    },
    "api_design": {
      "rest": {
        "url_structure": "RESTful URLs (/users/:id), versioning (/api/v1/)",
        "pagination": "Cursor-based pagination for large datasets",
        "filtering": "Query params for filtering (?status=active)",
        "sorting": "Sort query param (?sort=created_at:desc)"
      },
      "graphql": {
        "schema": "Type-safe schema with proper error handling",
        "rate_limiting": "Query complexity analysis, depth limiting",
        "subscriptions": "WebSocket-based subscriptions with auth"
      },
      "versioning": {
        "deprecation": "Deprecation warnings with sunset dates",
        "backward_compatibility": "Maintain backward compatibility for 6+ months"
      },
      "documentation": {
        "openapi": "OpenAPI 3.0 specification (Swagger)",
        "examples": "Include request/response examples",
        "error_codes": "Document all error codes and meanings"
      }
    },
    "data_persistence": {
      "database": {
        "migrations": "Version-controlled database migrations (Knex, Prisma)",
        "transactions": "Use transactions for multi-step operations",
        "optimization": "Indexes on foreign keys and query columns, query analysis"
      },
      "caching": {
        "strategies": "Cache-aside, write-through, write-behind",
        "invalidation": "Time-based (TTL) and event-based invalidation",
        "distributed_cache": "Redis cluster for distributed caching"
      },
      "event_sourcing": {
        "when_applicable": "Audit trails, complex workflows, temporal queries",
        "event_store": "Store events immutably (EventStore, Kafka)",
        "projections": "Build read models from events"
      },
      "data_retention": {
        "policies": "Define retention periods per data type",
        "archival": "Archive old data to cold storage (S3 Glacier)",
        "gdpr_compliance": "Right to erasure, data portability"
      }
    },
    "operational_excellence": {
      "monitoring": {
        "golden_signals": "Latency, traffic, errors, saturation",
        "metrics": "Custom business metrics (Prometheus, StatsD)",
        "dashboards": "Grafana dashboards for key metrics",
        "alerting": "Alert on SLO breaches, anomalies (PagerDuty, Opsgenie)"
      },
      "performance": {
        "sla_slo": "Define SLAs (99.9% uptime) and SLOs (P95 < 200ms)",
        "budgets": "Error budgets for controlled risk-taking",
        "optimization": "Profile and optimize hot paths (Clinic.js)"
      },
      "incident_management": {
        "on_call": "On-call rotation with runbooks",
        "response": "Incident response procedures, post-mortems",
        "runbooks": "Documented procedures for common issues"
      },
      "cost_optimization": {
        "resource_monitoring": "Monitor cloud costs (AWS Cost Explorer)",
        "cleanup": "Automated cleanup of unused resources",
        "tiered_storage": "Use appropriate storage tiers (S3 Standard, IA, Glacier)"
      }
    },
    "compliance": {
      "data_privacy": {
        "gdpr": "Right to access, erasure, portability, consent management",
        "ccpa": "California consumer privacy rights"
      },
      "industry_specific": {
        "pci_dss": "Payment card data security (if applicable)",
        "hipaa": "Healthcare data protection (if applicable)",
        "sox": "Financial audit trails (if applicable)"
      },
      "audit": {
        "logging": "Audit logs for security events, data access",
        "reporting": "Compliance reports, audit trails"
      }
    }
  },
  "questions": [
    {
      "name": "error_tracking_integration",
      "type": "choice",
      "prompt": "Error tracking integration for production?",
      "choices": [
        "none",
        "sentry",
        "datadog",
        "custom"
      ],
      "default": "none",
      "hint": "Sentry/Datadog integration for automatic error tracking and alerting"
    },
    {
      "name": "deployment_target",
      "type": "choice",
      "prompt": "Deployment target?",
      "choices": [
        "browser",
        "nodejs",
        "both",
        "edge_runtime"
      ],
      "default": "nodejs",
      "hint": "Affects polyfills, imports, async patterns"
    },
    {
      "name": "performance_critical",
      "type": "boolean",
      "prompt": "Is this performance-critical code?",
      "default": false,
      "hint": "Triggers: benchmarking, optimization, latency documentation"
    },
    {
      "name": "async_style",
      "type": "choice",
      "prompt": "Async pattern preference?",
      "choices": [
        "async_await",
        "promises",
        "callbacks",
        "mixed"
      ],
      "default": "async_await",
      "hint": "async/await preferred; callbacks for legacy compatibility"
    },
    {
      "name": "backward_compatibility",
      "type": "boolean",
      "prompt": "Must maintain backward compatibility?",
      "default": true,
      "hint": "Triggers: deprecation warnings, migration guides, version matrix"
    }
  ],
  "prompts": {
    "code_generation": "Generate production-quality JavaScript code for: {task}\n\nREQUIREMENTS:\n\n1. DOCUMENTATION STRUCTURE (human-first):\n\nHUMAN CONTENT (Top ~80 lines in JSDoc):\n/**\n * Module Name - Brief description\n *\n * **Purpose:** What this module does (clear statement)\n *\n * ## Quick Start\n * ```javascript\n * // Copy-paste example\n * import { myFunction } from './module.js';\n * const result = myFunction('example');\n * console.log(result); // Expected output\n * ```\n *\n * ## Public API\n * - `myFunction(param)` - Does something useful\n * - `anotherFunction(a, b)` - Combines inputs\n *\n * ## Error Handling\n * - Returns `{ ok: false, error }` on failure\n * - Throws `ValidationError` for invalid inputs\n *\n * ## Examples\n * ```javascript\n * // Success case\n * const result = myFunction('valid');\n * // result: { ok: true, value: 'processed' }\n *\n * // Error case\n * const result = myFunction(null);\n * // result: { ok: false, error: 'Invalid input' }\n * ```\n */\n\nSEPARATOR:\n---\n## AI Navigation Metadata\n// The sections below provide structured metadata for AI assistants,\n// graph databases (Neo4j), and vector databases (pgvector).\n\nAI METADATA (Below separator in JSDoc):\n- Module Identity (JSON in code block)\n- Architecture Diagram (Mermaid)\n- Call Graph (YAML)\n- Anti-Patterns (Markdown list)\n- Search Keywords (comma-separated)\n\n2. CODE QUALITY:\n- JSDoc for all public functions\n- Result objects: { ok: true, value } / { ok: false, error }\n- Custom error classes for domain errors\n- Vitest or Jest tests\n- ESLint + Prettier compliant\n- Use const/let, never var\n\n3. AI NAVIGATION (in module JSDoc):\n\nModule Identity (JSON):\n```json\n{\n  \"module\": \"module_name\",\n  \"purpose\": \"Clear unique purpose statement\",\n  \"layer\": \"api|service|util|component\",\n  \"export_type\": \"default|named\",\n  \"related_modules\": [\"express\", \"axios\", \"lodash\"],\n  \"alternatives\": {\n    \"OldModule\": \"Legacy - use this module instead\",\n    \"SimilarModule\": \"Different use case - see disambiguation\"\n  },\n  \"disambiguation\": {\n    \"vs_OldModule\": \"This module = modern async. OldModule = legacy callbacks\",\n    \"vs_SimilarModule\": \"This = server-side. SimilarModule = client-side\"\n  }\n}\n```\n\nArchitecture (Mermaid):\n```mermaid\ngraph TB\n    Caller[API Route] --> ThisModule[module_name]\n    ThisModule --> DB[Database]\n    ThisModule --> Cache[Redis]\n```\n\nCall Graph (YAML):\n```yaml\ncalls_out:\n  - module: './database'\n    functions: [query, insert]\n    purpose: Data persistence\n    critical: true\n\ncalled_by:\n  - module: './api/routes'\n    purpose: HTTP endpoints\n    frequency: high\n\ndepends_on:\n  - express (required)\n  - pg (required)\n  - redis (optional)\n```\n\nAnti-Patterns:\n\u274c DO NOT create 'module_wrapper' - use this module directly\n\u274c DO NOT use var - use const/let\n\u274c DO NOT ignore errors - always handle { ok, error } returns\n\nSearch Keywords:\njavascript-api, express-middleware, async-await, error-handling, production-ready\n\nOUTPUT CODE ONLY (with enhanced JSDoc).",
    "documentation": "Generate JSDoc for this JavaScript code:\n\n```javascript\n{code}\n```\n\nInclude:\n\nHUMAN CONTENT (top):\n- Module/function description with purpose\n- Quick start example\n- Public API list\n- Error handling\n- Examples with expected output\n\nSEPARATOR:\n---\n## AI Navigation Metadata\n\nAI METADATA (below):\n- Module Identity (JSON)\n- Architecture Diagram (Mermaid)\n- Call Graph (YAML)\n- Anti-Patterns\n- Search Keywords\n\nOUTPUT DOCUMENTATION ONLY.",
    "tests": "Generate Vitest/Jest tests for this code:\n\n```javascript\n{code}\n```\n\nInclude:\n- Unit tests for all public functions\n- Edge cases\n- Error handling tests\n- Use describe/it structure\n\nOUTPUT TEST CODE ONLY."
  },
  "scoring_weights": {
    "has_jsdoc": 1.0,
    "has_tests": 1.0,
    "error_handling": 1.0,
    "eslint_compliant": 1.0,
    "prettier_formatted": 1.0,
    "has_module_identity_json": 0.95,
    "has_architecture_diagram": 0.9,
    "has_call_graph_yaml": 0.9,
    "has_anti_patterns": 0.85,
    "has_search_keywords": 0.8,
    "human_content_first": 0.9,
    "clear_separation": 0.85,
    "ai_metadata_explained": 0.8,
    "graph_db_ready": 0.9,
    "vector_db_optimized": 0.9,
    "has_performance_characteristics": 0.9,
    "has_concurrency_safety_docs": 0.85,
    "has_degradation_patterns": 0.8,
    "has_version_compatibility": 0.85,
    "has_configuration_guide": 0.8,
    "has_observable_metrics": 0.9,
    "has_troubleshooting_guide": 0.75,
    "has_architecture_decisions": 0.7,
    "production_deployment_ready": 0.95,
    "security_reviewed": 0.95
  },
  "graph_model": {
    "version": 2,
    "node_types": {
      "module": {
        "id_format": "js://{path}",
        "merge_keys": [
          "path"
        ]
      },
      "function": {
        "id_format": "js://{path}#{name}/{arity}",
        "merge_keys": [
          "signature_hash"
        ]
      }
    },
    "edge_types": {
      "calls": {
        "from": "function",
        "to": "function",
        "weight": 0.9
      },
      "declares": {
        "from": "module",
        "to": "function",
        "weight": 1.0
      }
    },
    "extraction_rules": {
      "function_detection": "parse via acorn/babel AST",
      "call_graph": "static import + member expression resolution (best-effort)",
      "ai_metadata_extraction": "parse JSON/YAML/Mermaid from JSDoc comments"
    },
    "temporal": {
      "track": true,
      "fields": [
        "first_seen",
        "last_modified"
      ],
      "update_policy": "touch_last_modified_on_signature_change"
    },
    "error_semantics": {
      "severity_enum": [
        "fatal",
        "transient",
        "validation",
        "resource",
        "logic"
      ],
      "classification_enum": [
        "user_input",
        "system_state",
        "external_dependency",
        "data_integrity"
      ],
      "default_severity": "logic"
    }
  },
  "last_updated": "2025-10-26",
  "parent_pattern": null
}