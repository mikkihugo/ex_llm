================================================================================
VALIDATOR CONSOLIDATION - QUICK REFERENCE SUMMARY
================================================================================

TOTAL SCOPE: 9 validators, 1,939 lines of code

================================================================================
VALIDATOR INVENTORY TABLE
================================================================================

Module Name                    | File                                          | Lines | Status
---------------------------------------|-------|--------
1. CodeValidator               | singularity/lib/singularity/hot_reload       |  78   | ⚠️ Simple/Isolated
2. TemplateValidator (Quality) | singularity/lib/singularity/storage/code/    | 332   | ✅ Production
3. Templates.Validator         | singularity/lib/singularity/templates        | 186   | ✅ Production
4. MetadataValidator           | singularity/lib/singularity/analysis         | 553   | ✅ Production+AI
5. SecurityPolicy              | singularity/lib/singularity/tools            | 339   | ✅ Production
6. Tools.Validation            | singularity/lib/singularity/tools            | 154   | ✅ Operational
7. ValidatorType (Behavior)    | singularity/lib/singularity/validation       |  52   | ⚠️ Framework only
8. TemplateValidator (Impl)    | singularity/lib/singularity/validation/      |  71   | ⚠️ Isolated impl
9. PatternValidator (NATS)     | centralcloud/lib/centralcloud/nats           | 174   | ⚠️ Placeholder

TOTAL                          |                                               |1939   |

================================================================================
VALIDATOR API SURFACE (FRAGMENTED)
================================================================================

Validator Name                 | validate/N | Return Type               | Status
--------------------------------------|-----------|----------------------|--------
CodeValidator                  | validate/1 | {:ok,str}|{:err,exc}     | Unique
TemplateValidator(Quality)     | validate/4 | {:ok,%{...}}|{:err,any}  | Unique
Templates.Validator           | validate/1 | {:ok,map}|{:err,[...]}   | Unique
MetadataValidator             | validate/2 | %{level:a,score:f,...}   | Unique (no ok/err)
SecurityPolicy                | validate_*/1 | :ok|{:err,str}         | Binary result
Tools.Validation              | validate_*/0 | %{...}                 | Report map
ValidatorType (Behavior)      | validate/2 | :ok|{:err,[str]}         | Contract (unused)
TemplateValidator(Impl)       | validate/2 | :ok|{:err,[str]}         | Implements contract
PatternValidator(NATS)        | N/A         | NATS response JSON       | Distributed

PAIN POINT: 8 different return type signatures!

================================================================================
INTEGRATION MATRIX
================================================================================

Used By                        | Uses           | Integration Point
---------------------------------------|----------|-----
rag_code_generator.ex         | TemplateValidator  | After code generation
code_generator.ex             | TemplateValidator  | Quality check
rag.setup.ex                  | TemplateValidator  | Test validation
startup_code_ingestion.ex     | MetadataValidator  | During ingestion
unified_ingestion_service.ex  | MetadataValidator  | AST validation
Tools framework               | SecurityPolicy     | Tool execution
Mix task metadata.validate    | MetadataValidator  | CLI task
Template JSON import          | Templates.Validator| JSON import
N/A                           | ValidatorType      | Only 1 impl using it
N/A                           | PatternValidator   | NATS placeholders

PAIN POINT: ValidatorType behavior framework underutilized (8% adoption)

================================================================================
CONSOLIDATION ROADMAP
================================================================================

PHASE 1 (Week 1) - 36 hours
├── Update ValidatorType behavior contract
│   ├── Standardize return type: {:ok, %{valid, score, violations, details}}
│   ├── Add violation type: %{code, message, field, severity}
│   └── Config: load_enabled_validators/0
├── Migrate 8 validators to implement @behaviour
│   ├── All to: singularity/lib/singularity/validation/validators/
│   ├── Standardize: validate/2 with input + opts
│   └── Unified return handling
└── Update 5+ callers to new interface

PHASE 2 (Week 2) - 14 hours
├── CompositeValidator module
│   ├── validate_all/3 - AND logic
│   ├── validate_any/3 - OR logic
│   └── Use cases: multi-validator checks
└── Integration tests for composition

PHASE 3 (Week 3) - 14 hours
├── Validator Registry
│   ├── list/0, enabled/0
│   ├── call/3 - unified dispatch
│   └── Discovery system
└── Config-driven loading enhancement

PHASE 4 (Week 4) - 16 hours
├── Testing utilities
│   ├── Shared test macros
│   ├── Property-based test helpers
│   └── Reusable test fixtures
├── Documentation
│   ├── Migration guide
│   ├── New pattern examples
│   └── Integration guide
└── Deprecation warnings for old APIs

TOTAL EFFORT: ~80 hours (2 weeks FTE)

================================================================================
SUCCESS METRICS
================================================================================

Before                           | After              | Improvement
---------------------------------|-------------------|---------------
9 separate modules              | 1 behavior (8 impl)| Unified
1,939 LOC scattered             | ~600 LOC + utils   | 70% reduction
8 different APIs                | 1 standard API     | 100% consistency
0 composability                 | Full composition   | New capability
1 of 8 using behavior           | 8 of 8 using       | 100% adoption
No registry/discovery           | Registry system    | New capability
Different test patterns         | Unified test lib   | Maintainability
Config underutilized            | Full utilization   | Proper arch

================================================================================
FILES AFFECTED (37+ total)
================================================================================

VALIDATORS MOVING:
├── hot_reload/code_validator.ex → validation/validators/
├── storage/code/quality/template_validator.ex → validation/validators/
├── templates/validator.ex → validation/validators/
├── analysis/metadata_validator.ex → validation/validators/
├── tools/security_policy.ex → validation/validators/
├── tools/validation.ex → validation/validators/
└── validation/validators/template_validator.ex (already correct)

CALLERS TO UPDATE:
├── rag_code_generator.ex
├── code_generator.ex
├── rag.setup.ex
├── startup_code_ingestion.ex
├── unified_ingestion_service.ex
├── tool_execution_framework/
├── config/config.exs
└── all tests using validators

NEW FILES TO CREATE:
├── validation/registry.ex
├── validation/composite.ex
├── validation/testing.ex
└── test/validation/
    ├── template_validator_test.exs
    ├── code_quality_validator_test.exs
    ├── ... (7 more)
    └── composite_validator_test.exs

================================================================================
QUICK MIGRATION TEMPLATE
================================================================================

OLD CODE:
```elixir
alias Singularity.Code.Quality.TemplateValidator
case TemplateValidator.validate(code, template, lang) do
  {:ok, %{compliant: true}} -> use code
  {:error, reason} -> reject code
end
```

NEW CODE:
```elixir
alias Singularity.Validation.Registry
case Registry.call(:code_quality, code, template: template, language: lang) do
  {:ok, %{valid: true, score: score}} -> use code
  {:error, reason} -> reject code
end
```

BACKWARD COMPAT:
- Old modules aliased to new locations
- Deprecation warnings for 2 releases
- Gradual migration path

================================================================================
KEY RECOMMENDATIONS
================================================================================

1. START PHASE 1 IMMEDIATELY
   - Update ValidatorType contract (4h)
   - Migrate TemplateValidator (4h) - easiest, already has behavior impl
   - Test thoroughly (4h)
   - Then batch the rest

2. USE COMPOSITION EARLY
   - Metadata + Code Quality validation together
   - Template schema + composition refs together
   - Plan integration tests first

3. CONFIG-DRIVEN DISCOVERY
   - Enable/disable validators via config
   - Allow custom validator registration
   - Support future validators without code change

4. TESTING STRATEGY
   - Shared test fixtures (valid/invalid inputs)
   - Property-based testing for violation codes
   - Contract testing between phases
   - Integration test with all validators

5. DOCUMENTATION
   - Copy this report to repo
   - Add migration guide for each phase
   - Document new patterns with examples
   - Update CLAUDE.md with validation section

================================================================================

FULL REPORT: VALIDATOR_CONSOLIDATION_REPORT.md

