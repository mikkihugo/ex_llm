#!/usr/bin/env bash
# Extract GitHub Copilot OAuth token from VS Code

set -euo pipefail

echo "ðŸ” Looking for GitHub Copilot tokens..."
echo

# Check ~/.config/github-copilot/hosts.json
if [ -f ~/.config/github-copilot/hosts.json ]; then
    echo "âœ“ Found ~/.config/github-copilot/hosts.json"
    cat ~/.config/github-copilot/hosts.json | jq -r '.["github.com"].oauth_token' 2>/dev/null || echo "Failed to parse"
    exit 0
fi

# Check ~/.config/github-copilot/apps.json
if [ -f ~/.config/github-copilot/apps.json ]; then
    echo "âœ“ Found ~/.config/github-copilot/apps.json"
    cat ~/.config/github-copilot/apps.json | jq -r '.[].oauth_token' 2>/dev/null || echo "Failed to parse"
    exit 0
fi

echo "âœ— No Copilot token files found"
echo
echo "To get a Copilot token:"
echo "1. Open VS Code with GitHub Copilot extension"
echo "2. Sign in to Copilot (if not already)"
echo "3. The token will be saved to ~/.config/github-copilot/hosts.json"
echo
echo "Or manually create ~/.config/github-copilot/hosts.json:"
echo '{"github.com":{"user":"YOUR_USERNAME","oauth_token":"gho_YOUR_TOKEN"}}'
