$schema: '../.moon/cache/schemas/project.json'

language: 'rust'
type: 'library'

tasks:
  build:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo build --release"'
    inputs:
      - '**/*.rs'
      - 'Cargo.toml'
      - 'Cargo.lock'
    outputs:
      - 'target/'

  test:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo test"'
    deps:
      - 'build'
    inputs:
      - '**/*.rs'
      - 'Cargo.toml'
      - 'Cargo.lock'
    options:
      runInCI: true

  check:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo check"'
    inputs:
      - '**/*.rs'
      - 'Cargo.toml'

  clippy:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo clippy --all-targets"'
    inputs:
      - '**/*.rs'
      - 'Cargo.toml'
    options:
      runInCI: true

  fmt:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo fmt --check"'
    inputs:
      - '**/*.rs'
    options:
      runInCI: true

  clean:
    command: 'nix develop ..#dev --command bash -c "cd rust_global && cargo clean"'
    local: true
