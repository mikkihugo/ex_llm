name: Copilot Setup Steps
on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize]

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest

    services:
      postgres:
        image: postgres:16
        ports:
          - 5432:5432
        env:
          POSTGRES_PASSWORD: postgres
          POSTGRES_USER: postgres
          POSTGRES_DB: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
        
      - name: Set up Elixir/Erlang/Gleam/Rebar3
        uses: erlef/setup-beam@v1
        with:
          otp-version: '28'
          elixir-version: '>0'
          gleam-version: '>0'
          rebar3-version: '>0'

      - name: Set up Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          components: rustfmt
 
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest
