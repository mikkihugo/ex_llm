$schema: '../.moon/cache/schemas/project.json'

type: 'application'
language: 'elixir'

project:
  name: 'nexus'
  description: 'LLM Router and HITL Bridge - Routes LLM requests using ex_llm'

tasks:
  deps:
    command: 'nix develop ..#dev --command mix deps.get'
    inputs:
      - 'mix.exs'
      - 'mix.lock'

  compile:
    command: 'nix develop ..#dev --command mix compile'
    inputs:
      - 'lib/**/*.ex'
      - 'mix.exs'
    deps:
      - '~:deps'

  test:
    command: 'nix develop ..#dev --command mix test'
    inputs:
      - 'lib/**/*.ex'
      - 'test/**/*.exs'
    deps:
      - '~:compile'

  format:
    command: 'nix develop ..#dev --command mix format'
    inputs:
      - 'lib/**/*.ex'
      - 'test/**/*.exs'
      - '.formatter.exs'

  format-check:
    command: 'nix develop ..#dev --command mix format --check-formatted'
    inputs:
      - 'lib/**/*.ex'
      - 'test/**/*.exs'
      - '.formatter.exs'

  run:
    command: 'nix develop ..#dev --command iex -S mix'
    local: true
    deps:
      - '~:compile'
