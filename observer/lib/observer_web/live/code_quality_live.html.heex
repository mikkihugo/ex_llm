<div class="min-h-screen bg-gray-50 p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-4xl font-bold text-gray-900">üìä Code Quality Analytics</h1>
        <button
          phx-click="refresh"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
        >
          üîÑ Refresh
        </button>
      </div>
      <p class="text-gray-600">Quality scores, violations, improvement trends, and technical debt tracking</p>
    </div>

    <!-- Loading State -->
    <%= if @loading do %>
      <div class="flex items-center justify-center h-64">
        <div class="text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-gray-600">Loading code quality metrics...</p>
        </div>
      </div>
    <% else %>
      <!-- Error State -->
      <%= if @error do %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
          <p class="text-red-800">‚ö†Ô∏è Error: <%= @error %></p>
        </div>
      <% else %>
        <!-- Dashboard Content -->
        <%= if @dashboard do %>
          <!-- Health Status -->
          <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Overall Health</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <!-- Health Status -->
              <div class="bg-white rounded-lg shadow-md p-6">
                <p class="text-sm text-gray-600 mb-2">Health Status</p>
                <div class="flex items-center gap-3 mb-4">
                  <span class="text-4xl font-bold text-blue-600">
                    <%= case @dashboard.health_status do
                      :excellent -> "‚úÖ"
                      :good -> "üëç"
                      :fair -> "‚ö†Ô∏è"
                      :poor -> "‚ùå"
                      _ -> "‚ùì"
                    end %>
                  </span>
                  <div>
                    <p class="text-lg font-semibold text-gray-900">
                      <%= @dashboard.health_status |> Atom.to_string() |> String.upcase() %>
                    </p>
                    <p class="text-sm text-gray-600">System health</p>
                  </div>
                </div>
              </div>

              <!-- Test Coverage -->
              <%= if @dashboard.test_metrics do %>
                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Test Coverage</p>
                  <p class="text-3xl font-bold text-green-600">
                    <%= @dashboard.test_metrics.coverage_percent %>%
                  </p>
                  <p class="text-sm text-gray-600 mt-2">
                    Success Rate: <%= @dashboard.test_metrics.success_rate_percent %>%
                  </p>
                </div>
              <% end %>

              <!-- Documentation -->
              <%= if @dashboard.documentation_coverage do %>
                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Documentation Coverage</p>
                  <p class="text-3xl font-bold text-purple-600">
                    <%= @dashboard.documentation_coverage.coverage_percent %>%
                  </p>
                  <p class="text-sm text-gray-600 mt-2">
                    Modules documented
                  </p>
                </div>
              <% end %>
            </div>
          </section>

          <!-- Complexity Metrics -->
          <%= if @dashboard.complexity_metrics do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Code Complexity</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <p class="text-sm text-gray-600 mb-2">Average Complexity</p>
                    <p class="text-3xl font-bold text-blue-600">
                      <%= @dashboard.complexity_metrics.average %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                      Status:
                      <span class="font-semibold <%= case @dashboard.complexity_metrics.status do %>
                        <%= :good -> "text-green-600" %>
                        <%= :fair -> "text-yellow-600" %>
                        <%= :needs_improvement -> "text-red-600" %>
                        <%= _ -> "text-gray-600" %>
                      <% end %>">
                        <%= @dashboard.complexity_metrics.status |> Atom.to_string() |> String.upcase() %>
                      </span>
                    </p>
                  </div>

                  <div>
                    <p class="text-sm text-gray-600 mb-2">Maximum Complexity</p>
                    <p class="text-3xl font-bold text-red-600">
                      <%= @dashboard.complexity_metrics.maximum %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">
                      Highest complexity function
                    </p>
                  </div>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Violations Summary -->
          <%= if @dashboard.violations_summary do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Code Violations</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                  <div class="text-center">
                    <p class="text-4xl font-bold text-red-600">
                      <%= @dashboard.violations_summary.critical || 0 %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">Critical</p>
                  </div>

                  <div class="text-center">
                    <p class="text-4xl font-bold text-orange-600">
                      <%= @dashboard.violations_summary.warnings || 0 %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">Warnings</p>
                  </div>

                  <div class="text-center">
                    <p class="text-4xl font-bold text-blue-600">
                      <%= @dashboard.violations_summary.info || 0 %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">Info</p>
                  </div>

                  <div class="text-center">
                    <p class="text-4xl font-bold text-gray-600">
                      <%= @dashboard.violations_summary.total || 0 %>
                    </p>
                    <p class="text-sm text-gray-600 mt-2">Total</p>
                  </div>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Health Trend -->
          <%= if @dashboard.health_trend do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Health Trend</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <p class="text-center text-gray-600">
                  <%= case @dashboard.health_trend do %>
                    <%= :improving -> "üìà Code quality is improving" %>
                    <%= :stable -> "‚Üí Code quality is stable" %>
                    <%= :declining -> "üìâ Code quality is declining" %>
                    <%= _ -> "Trend data unavailable" %>
                  <% end %>
                </p>
              </div>
            </section>
          <% end %>

          <!-- Last Updated -->
          <div class="text-sm text-gray-500 text-right">
            Last updated: <%= @dashboard.timestamp |> DateTime.truncate(:second) |> DateTime.to_string() %>
          </div>
        <% else %>
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
            <p class="text-gray-600">No code quality data available</p>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
