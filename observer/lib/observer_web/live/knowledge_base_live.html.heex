<div class="min-h-screen bg-gray-50 p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-4xl font-bold text-gray-900">üìö Knowledge Base Browser</h1>
        <button
          phx-click="refresh"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
        >
          üîÑ Refresh
        </button>
      </div>
      <p class="text-gray-600">Embedding effectiveness, cache performance, and semantic search quality</p>
    </div>

    <!-- Loading State -->
    <%= if @loading do %>
      <div class="flex items-center justify-center h-64">
        <div class="text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-gray-600">Loading knowledge base metrics...</p>
        </div>
      </div>
    <% else %>
      <!-- Error State -->
      <%= if @error do %>
        <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-8">
          <p class="text-red-800">‚ö†Ô∏è Error: <%= @error %></p>
        </div>
      <% else %>
        <!-- Dashboard Content -->
        <%= if @dashboard do %>
          <!-- Efficiency Score -->
          <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Overall Efficiency</h2>
            <div class="bg-white rounded-lg shadow-md p-8 text-center">
              <div class="flex items-center justify-center mb-4">
                <div class="text-7xl font-bold text-blue-600">
                  <%= Float.round(@dashboard.efficiency_score.overall, 1) %>/100
                </div>
              </div>
              <p class="text-lg font-semibold text-gray-900 mb-6">
                <%= case @dashboard.efficiency_score.status do
                  :excellent -> "‚úÖ Excellent"
                  :good -> "üëç Good"
                  :fair -> "‚ö†Ô∏è Fair"
                  _ -> "Unknown"
                end %>
              </p>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                  <p class="text-sm text-gray-600">Cache Efficiency</p>
                  <p class="text-2xl font-bold text-green-600">
                    <%= Float.round(@dashboard.efficiency_score.cache_efficiency, 1) %>
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Search Quality</p>
                  <p class="text-2xl font-bold text-blue-600">
                    <%= Float.round(@dashboard.efficiency_score.search_quality, 1) %>
                  </p>
                </div>
                <div>
                  <p class="text-sm text-gray-600">Latency Efficiency</p>
                  <p class="text-2xl font-bold text-purple-600">
                    <%= Float.round(@dashboard.efficiency_score.latency_efficiency, 1) %>
                  </p>
                </div>
              </div>
            </div>
          </section>

          <!-- Cache Performance -->
          <%= if @dashboard.cache_metrics do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Cache Performance</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Hit Rate</p>
                  <p class="text-3xl font-bold text-green-600">
                    <%= format_percentage(@dashboard.cache_metrics.hit_rate) %>%
                  </p>
                  <p class="text-sm text-gray-600 mt-2">
                    <%= @dashboard.cache_metrics.hits %> hits / <%= @dashboard.cache_metrics.total_queries %> queries
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Miss Rate</p>
                  <p class="text-3xl font-bold text-orange-600">
                    <%= format_percentage(@dashboard.cache_metrics.miss_rate) %>%
                  </p>
                  <p class="text-sm text-gray-600 mt-2">
                    <%= @dashboard.cache_metrics.misses %> misses
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Cache Size</p>
                  <p class="text-3xl font-bold text-blue-600">
                    <%= @dashboard.cache_metrics.cache_size_mb %>MB
                  </p>
                  <p class="text-sm text-gray-600 mt-2">
                    Eviction rate: <%= format_percentage(@dashboard.cache_metrics.eviction_rate) %>%
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Hit Latency</p>
                  <p class="text-3xl font-bold text-green-600">
                    <%= @dashboard.cache_metrics.avg_hit_latency_ms %>ms
                  </p>
                  <p class="text-sm text-gray-600 mt-2">Average response time</p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Miss Latency</p>
                  <p class="text-3xl font-bold text-orange-600">
                    <%= @dashboard.cache_metrics.avg_miss_latency_ms %>ms
                  </p>
                  <p class="text-sm text-gray-600 mt-2">Embedding generation</p>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Search Metrics -->
          <%= if @dashboard.search_metrics do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Search Effectiveness</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Relevance Rate</p>
                    <p class="text-4xl font-bold text-green-600">
                      <%= format_percentage(@dashboard.search_metrics.relevance_rate) %>%
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Avg Relevance Score</p>
                    <p class="text-4xl font-bold text-blue-600">
                      <%= Float.round(@dashboard.search_metrics.avg_relevance_score, 2) %>
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Total Searches</p>
                    <p class="text-4xl font-bold text-purple-600">
                      <%= @dashboard.search_metrics.total_searches %>
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600 mb-2">Relevant Results</p>
                    <p class="text-4xl font-bold text-green-600">
                      <%= @dashboard.search_metrics.relevant_results %>
                    </p>
                  </div>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Knowledge Base Growth -->
          <%= if @dashboard.kb_growth do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Knowledge Base Stats</h2>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Total Chunks</p>
                  <p class="text-3xl font-bold text-blue-600">
                    <%= @dashboard.kb_growth.total_chunks %>
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Total Tokens</p>
                  <p class="text-3xl font-bold text-purple-600">
                    <%= div(@dashboard.kb_growth.total_tokens, 1000) %>K
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Storage Used</p>
                  <p class="text-3xl font-bold text-orange-600">
                    <%= @dashboard.kb_growth.storage_size_mb %>MB
                  </p>
                </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                  <p class="text-sm text-gray-600 mb-2">Daily Growth Rate</p>
                  <p class="text-3xl font-bold text-green-600">
                    +<%= @dashboard.kb_growth.growth_rate_per_day %>
                  </p>
                  <p class="text-xs text-gray-600">chunks/day</p>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Model Performance -->
          <%= if @dashboard.model_performance do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Embedding Model</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <p class="font-semibold text-gray-900 mb-4">
                      <%= @dashboard.model_performance.model %>
                    </p>
                    <div class="space-y-3">
                      <div>
                        <p class="text-sm text-gray-600">Dimensions</p>
                        <p class="text-lg font-bold text-gray-900">
                          <%= @dashboard.model_performance.dimensions %>
                        </p>
                      </div>
                      <div>
                        <p class="text-sm text-gray-600">Version</p>
                        <p class="text-lg font-bold text-gray-900">
                          v<%= @dashboard.model_performance.model_version %>
                        </p>
                      </div>
                    </div>
                  </div>

                  <div>
                    <div class="space-y-3">
                      <div>
                        <p class="text-sm text-gray-600">Accuracy</p>
                        <p class="text-3xl font-bold text-green-600">
                          <%= Float.round(@dashboard.model_performance.accuracy * 100, 1) %>%
                        </p>
                      </div>
                      <div>
                        <p class="text-sm text-gray-600">Latency</p>
                        <p class="text-lg font-bold text-gray-900">
                          <%= @dashboard.model_performance.latency_ms %>ms
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Search Latency -->
          <%= if @dashboard.latency_metrics do %>
            <section class="mb-8">
              <h2 class="text-2xl font-bold text-gray-900 mb-4">Search Latency Percentiles</h2>
              <div class="bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                  <div class="text-center">
                    <p class="text-sm text-gray-600">P50</p>
                    <p class="text-3xl font-bold text-blue-600">
                      <%= @dashboard.latency_metrics.p50_ms %>ms
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600">P95</p>
                    <p class="text-3xl font-bold text-yellow-600">
                      <%= @dashboard.latency_metrics.p95_ms %>ms
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600">P99</p>
                    <p class="text-3xl font-bold text-orange-600">
                      <%= @dashboard.latency_metrics.p99_ms %>ms
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600">Average</p>
                    <p class="text-3xl font-bold text-green-600">
                      <%= @dashboard.latency_metrics.avg_ms %>ms
                    </p>
                  </div>

                  <div class="text-center">
                    <p class="text-sm text-gray-600">Max</p>
                    <p class="text-3xl font-bold text-red-600">
                      <%= @dashboard.latency_metrics.max_ms %>ms
                    </p>
                  </div>
                </div>
              </div>
            </section>
          <% end %>

          <!-- Last Updated -->
          <div class="text-sm text-gray-500 text-right">
            Last updated: <%= @dashboard.timestamp |> DateTime.truncate(:second) |> DateTime.to_string() %>
          </div>
        <% else %>
          <div class="bg-gray-50 border border-gray-200 rounded-lg p-8 text-center">
            <p class="text-gray-600">No knowledge base data available</p>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
